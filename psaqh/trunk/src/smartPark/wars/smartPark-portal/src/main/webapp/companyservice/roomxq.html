<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>会议室预定详情</title>
<link href="../styles/base.css" type="text/css" rel="stylesheet">
<link href="../styles/page/page.css" type="text/css" rel="stylesheet">
<link href="../styles/page/fullcalendar.css" rel="stylesheet" type="text/css">
</head>

<body>
<div id="youi_page_header" class="youi-page-header clearfix"></div>
<!--***top end****************************************-->
<!--content-->
<div class="bgf1">
<div class="w1200 pt20">
	<ul class="linknav clearfix">
    	<li><a href="#">首页</a></li>
        <li><a href="#">企业服务</a></li>
        <li><a href="carLease.html">公共资源</a></li>
        <li class="active"><a href="carLeasexq.html">广告资源详情</a></li>
    </ul>
    <div class="mt30 clearfix">
    	<div class="fl ml10"></div>
        <div class="carxq fl">
        	<span class="span_bold f20" id="commodityName"></span>
            <div class="mt20 mb20">
                <div class="res_tip" id="dw">自动挡</div>
                <div class="res_tip" id="zw">9人座</div>
                <div class="res_tip" id="cp">车牌：杭AL8899</div>
			</div>
            <div class="egbg"><span id="commodityPrice">&yen;</span>元&nbsp;<span class="f16">/1次</span></div>
            <p class="f12 mt20" style="width:360px;" id="commodityDescribe">
            	此车仅供园区企业接送飞机使用<br/>
                按照每次500元计算，此价格包含60KM的油费<br/>
                师傅一名，工作2小时<br/>
                如果超公里，按照每公里3元收费，超过2小时按照每小时50元收费。
            </p>
        </div>
        <div class="fl userxq">
        	<div><img src="../styles/images/company/man.png"/></div>
            <div class="mt40">
            	<img src="../styles/images/company/res_icon.png" class="mr10"/><span class="vm" id="merchantName">联系人：小周</span>
                <div class="mt10"><img src="../styles/images/company/res_ico.png" class="mr10"/><span class="vm" id="merchantPhone">联系电话：13456786986</span></div>
            </div>
        </div>
    </div>
</div><!--content***************  end-->

<div class="w1200 pt40 pb40"><!--选择-->
 	<div id='calendar'>
    	<div class="absolute_div">
            <div class="colorblock" style="background:#A2354A"></div><span class="vm">&nbsp;已预约（不可选）</span>
            <div class="colorblock" style="background:#4AA2D4"></div><span class="vm">&nbsp;可预约</span>
            <div class="colorblock" style="background:#C0C0C0"></div><span class="vm">&nbsp;已过期</span>
        </div>
    	<table id="data_timer">
        	 <tr>
            	<td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
            </tr>
            <tr>
            	<td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
            </tr>
            <tr>
            	<td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
            </tr>
            <tr>
            	<td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
            </tr>
            <tr>
            	<td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
            </tr>
            <tr>
            	<td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
            </tr>
            <tr>
            	<td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
            </tr>
            <tr>
            	<td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
            </tr>
            <tr>
            	<td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
            </tr>
            <tr>
            	<td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
            </tr>
           
        </table>
        <div class="tc mt50" id="commit">
        	<div class="btn-ck mr20" id="online">在线预约</div>
            <div class="btn-zz">立即支付</div>
            <div class="cc mt20">*请注意，只能选择连续的时间段</div>
        </div>
    </div> 
</div><!--content***************  end-->
</div>    
    
<!--***bottom start****************************************-->
	<div id="youi_page_footer" class="youi-page-footer"></div>
<!--***bottom end****************************************-->
<div class="pop_layer">
	<div class="online_box clearfix">
    	<div class="fl w95">
        	<div class="on_title">
            	<span class="span_bold f18">填写在线预约单</span>
            </div>
            <div class="cc mt15 f12">*为了保证您的旅行顺利出行，请务必填写真实信息</div>
            <form class="online_form mt20">
            	<div>
                    <div class="inline_b">
                        <label><span class="cc vm">*</span>&nbsp;联系人</label>
                        <input type="text" id="enteringName" name="enteringName"/>
                    </div>
                    <div class="inline_b ml40">
                        <label><span class="cc vm">*</span>&nbsp;联系电话</label>
                        <input type="text" id="enteringTelephone" name="enteringTelephone"/>
                    </div>
                </div>
                <div class="mt25">
                    <div class="inline_b">
                        <label><span class="cc vm">*</span>&nbsp;联系邮箱</label>
                        <input type="text"/>
                    </div>
                    <div class="inline_b ml40">
                        <label>&nbsp;&nbsp;&nbsp;增值服务</label>
                        <input type="checkbox" class="vm"/><span class="vm c3">司机</span>
                    </div>
                </div>
                <div class="mt25">
                	<label class="vt">&nbsp;&nbsp;&nbsp;备注</label>
                    <textarea style="width:552px;height:150px"></textarea>
                </div>
                <div class="tc mt50">
                	<div class="btn-cheng" style="padding:10px 30px">提交预约</div>
                </div>
            </form>
        </div>
    	<div class="close0 fr"></div>
    </div>
</div>
<!--******************  code end  ****************************-->
<script type="text/javascript" src="../scripts/lib/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../scripts/lib/jquery-ui.min.js"></script>
<script type="text/javascript" src="../scripts/lib/bootstrap.min.js"></script>
<script type="text/javascript" src="../scripts/lib/giui.min.js"></script>
<script type="text/javascript" src="../scripts/page/pagewrapper.js"></script>
<script src='../scripts/page/date_week/moment.min.js'></script>
<script src='../scripts/page/date_week/fullcalendar.min.js'></script>
<script src='../scripts/page/date_week/lang-all.js'></script>
<script type="text/javascript" src="../scripts/page/kefu.js"></script>
<Script  type="text/javascript">
function GetRequest() {
   var url = location.search; //获取url中"?"符后的字串
   var theRequest = new Object();
   if (url.indexOf("?") != -1) {
      var str = url.substr(1);
      strs = str.split("&");
      for(var i = 0; i < strs.length; i ++) {
         theRequest[strs[i].split("=")[0]]=(strs[i].split("=")[1]);
      }
   }
   return theRequest;
}
</Script>
<script>

	$(document).ready(function() {
		var htmls=$("#data_timer").html();
		var currentLangCode = 'zh-cn';

		function renderCalendar() {
			$('#calendar').fullCalendar({
				header: {
					left: 'title',
					center: 'prev,next',
					right: ''
				},
				defaultView: 'agendaWeek',
				lang: currentLangCode,
				agenda: null, 
			});
		}
		renderCalendar();
		/**/
		var today,cursor=0;
		today=new Date().getDay();
		nowday();
		$("#data_timer").on("click","td",function(){
			if(this.className=="pasttd"){return ;}
			$(this).toggleClass("clicktd");
		});
		
		$(".fc-next-button").on("click",this,function(){
			cursor++;
			var flag=judgment();
			console.log(cursor);
			if(cursor==0){nowday();return ;}
			if(flag){
				$("#data_timer").html(htmls);
			}
		});
		$(".fc-prev-button").on("click",this,function(){
			cursor--;
			var flag=judgment();
			console.log(cursor);
			if(cursor==0){nowday();return ;}
			if(!flag){
				$("#data_timer td").addClass("pasttd");
			}
			else{
				$("#data_timer").html(htmls);
			}
		});
		function nowday(){
			if(today==0){today=7};
			$("#data_timer").html(htmls);
			$("#data_timer tr").each(function(index, element) {
				$(element).children("td").eq(today).prevAll("td").addClass("pasttd");
			});
		};
		function judgment(){
			var data_date=$(".fc-mon").attr("data-date");
			var date=new Date(data_date);
			var tt=Date.now();
			if(date>tt){return 1;}
			else{return 0;}
		}
	});

</script>
<script>
	$(function(){
		var Request = new Object();
		var imageUrl="/filestore/";
		Request = GetRequest();
		var commodityId=Request['id'];
		var genreCode='0301';
		var params = ['commodityId='+commodityId,'genreCode='+genreCode];
		var serviceURL = baseUrl+"publicutilitiesmanagerResoManager/getPagerPublicCommoditys.json";
	//	var serviceURL = "http://localhost:8088/smartPark-web/esb/web/purchasingmanagerCommodityManager/getPurchasingmanagerCommodity.json?commodityId="+commodityId;
		$.youi.ajaxUtils.ajax({
			url:serviceURL,
			data:params.join('&'),
			jsonp:'data:jsonp',
			dataType:'jsonp',
			success:function(results){
				if(results&&results.records){
					var records=results.records;
					$('.ml10').append("<img src='"+imageUrl+records[0].commodityImage+"' height='261' width='385'/>");
					$('#commodityName').text(records[0].commodityTitle);
					$('#commodityPrice').text(records[0].commodityPrice);
					$('#commodityDescribe').html(records[0].commodityDescribe);
					$('#merchantName').text("联系人："+records[0].merchantLinkman);
					$('#merchantPhone').text("联系电话："+records[0].merchantLinkmanPhone);
					if(records[0].dwValue != null){
						$('#dw').text(records[0].dwValue);
					}
					if(records[0].zwValue != null){
						$('#zw').text(records[0].zwValue);
					}
					if(records[0].cpValue != null){
						$('#cp').text(records[0].cpValue);
					}
				}
			}
		});
		
		$("#online").click(function(){
			$(".pop_layer").show();
		});
		$(".close0").click(function(){
			$(".pop_layer").hide();
		});
	})
</script>
<script type="text/javascript">
		    //提交预约
			$('.btn-cheng').click(function(){
				if(!isLogin){alert("请登录");return;}
				
				var arr=new Array();
				$("#data_timer td.clicktd").each(function(){
					var active=$(this).index();
					var time=$(this).html();
					var dates=$(".fc-day-header").eq(active).attr("data-date")+time;
					arr.push(dates);
				});
				
				if(arr.length>0){
	        		var userorderAmount=$('#commodityPrice').text();
					arr=['40288ab553647ad3015364a484a90020','40288ab553647ad3015364a2b10e001c'];
					var string ="";
					for(var i=0;i<arr.length;i++){
						string+="records["+i+"].resoId="+arr[i]+"&";
					}
					string+="userorderAmount="+userorderAmount;
				 
				   var serviceURL =baseUrl+"publicutilitiesmanagerResoManager/savePublicResoOrderByList.json";
					//公共方法
					$.youi.ajaxUtils.ajax({
						url:serviceURL,
						data:string,
						jsonp:'data:jsonp',
						dataType:'jsonp',
						success:function(result){
							if(result&&result.record){
								alert("预约成功");
								$(".pop_layer").hide();
							}
						}
					});
	            }else{
	            	alert("请选择预约日期和时间段");
	            }	
			});
	</script>
</body>
</html>
