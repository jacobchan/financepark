<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>车位预定</title>
<link href="../styles/page/awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet">
<link href="../styles/base.css" type="text/css" rel="stylesheet">
<link href="../styles/page/page.css" type="text/css" rel="stylesheet">


<script type="text/javascript" src="../scripts/lib/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../scripts/lib/jquery-ui.min.js"></script>
<script type="text/javascript" src="../scripts/lib/bootstrap.min.js"></script>
<script type="text/javascript" src="../scripts/lib/giui.min.js"></script>
<script type="text/javascript" src="../scripts/page/newscom.js"></script>
<script type="text/javascript" src="../scripts/page/kefu.js"></script>
<script type="text/javascript" src="../scripts/page/pagewrapper.js"></script>
<script type="text/javascript" src="../scripts/page/url.js"></script>
<script type="text/javascript" src="../scripts/page/laydate/laydate.js"></script>
<script type="text/javascript" src="../scripts/page/jquery.page.js"></script>

</head>

<body>
<div id="youi_page_header" class="youi-page-header clearfix"></div>
<!--***top end****************************************-->
<!--content-->
<div class="w1200 pt20">
	<ul class="linknav clearfix">
    	<li><a href="#">首页</a></li>
        <li><a href="#">企业服务</a></li>
        <li class="active"><a href="#">公共资源</a></li>
    </ul>
    <div class="resbox clearfix">
        <ul class="res_ul clearfix fr">
            <li><a href="carLease.html">车辆租凭</a></li>
            <li class="active"><a href="carVip.html">停车位预留</a></li>
            <li><a href="advert.html">广告资源预定</a></li>
            <li><a href="room.html">会议室预定</a></li>
        </ul>
    </div>
    <!--停车位缴费-->
    <div class="res_item mb40">
        <div><img src="../styles/images/company/head-top.jpg"/></div>
        <div class="clearfix mt30">
            <div class="res_left p20">
                <table class="setting-table">
                    <colgroup>
                        <col width="80">
                        <col>
                        <col width="120">
                        <col>
                    </colgroup>
                    <tbody><tr id="">
                        <td align="center">企业名称</td>
                        <td><input id="cpEnName" type="text"></td>
                        <td align="center">联系人</td>
                        <td><input id="cpLinkMan" type="text"></td>
                    </tr>
                    <tr>
                        <td align="center">公司地址</td>
                        <td><input id="cpEnAdr" type="text"></td>
                        <td align="center">联系方式</td>
                        <td>
                            <input type="text" id="cpLinkTel">
                        </td>
                    </tr>
                    <tr>
                        <td align="center">开始时间</td>
                        <td colspan="3">
                            <input class="laydate-icon fl" type="text"  placeholder="请选择日期" style="width:180px;" id="startTime">
                            <div class="fl ml10 select-time pr">
                                <input placeholder="请选择时间" type="text"  style="width:180px;" >
                                 <div style="top:30px;" class="time-nav">
                                    <ul id="cpBegionTime">
                                        <li>08:00</li>
                                        <li>09:00</li>
                                        <li>10:00</li>
                                        <li>11:00</li>
                                        <li>12:00</li>
                                        <li>13:00</li>
                                        <li>14:00</li>
                                        <li>15:00</li>
                                        <li>16:00</li>
                                        <li>17:00</li>
                                        <li>18:00</li>
                                    </ul>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td align="center">结束时间</td>
                        <td colspan="3">
                            <input class="laydate-icon fl" type="text"  placeholder="请选择日期" style="width:180px;" id="endTime">
                            <div class="fl ml10 select-time pr">
                                <input placeholder="请选择时间" type="text" style="width:180px;">
                                 <div style="top:30px;" class="time-nav">
                                    <ul id="cpEntdTime">
                                        <li>08:00</li>
                                        <li>09:00</li>
                                        <li>10:00</li>
                                        <li>11:00</li>
                                        <li>12:00</li>
                                        <li>13:00</li>
                                        <li>14:00</li>
                                        <li>15:00</li>
                                        <li>16:00</li>
                                        <li>17:00</li>
                                        <li>18:00</li>
                                    </ul>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td align="center" valign="top">车位数量</td>
                        <td colspan="3"><input type="text" id="cpCount" style="width:120px;"><p class="f12 cc mt15">费用说明：25元／小时</p></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                        	<input value="在线预订" id="sub" class="btn-cheng submit1"  type="submit" style="width:120px;height:40px;">
                        	<input value="提交中..."  class="btn-cheng submit2 undis"  type="submit" style="width:120px;height:40px;">
                        	<p class="f16 cc mt15" id="submsg" style="display:none">请登录后，提交预约!</p>
                        </td>
                    </tr>
                </tbody></table> 
            </div>
            <div class="res_right">
                <div id="youi_page_ri" class="youi-page-ri clearfix"></div>
            </div> 
        </div>
        
    </div><!--res_item  end-->
    <!--停车位缴费-->

</div>
<!--***bottom start****************************************-->
<div id="youi_page_footer" class="youi-page-footer"></div>
<!--***bottom end****************************************-->


<!--**浮窗 star**-->


<!--**浮窗 end**-->

<!--******************  code end  ****************************-->



    <script type="text/javascript">
	  //toast弹窗出来后，一秒自动关闭,请再调用弹窗toast的时候调用该方法
	    function jump1(i){
	    	$("#ti-m1").text(i);
	    	i = i - 1;
			if(i>0){
				setTimeout("jump1("+i+")", 2000);
			}else{
				window.location=cenUrl+"member/memberCenter/personalCenter/orderCenter.html";
			}		
		}
	    
        $(function(){
        	//页面初始化加载公司名称
        	$.getScript(cenUrl+'portal/userInfo.html',function(){
				if($.youi.serverConfig.authorization){
					$.youi.ajaxUtils.ajax({
						url:baseUrl+'memberInformationManager/getMemberInformationByLoginUser.json',
						jsonp : 'data:jsonp',
						dataType : 'jsonp',
						success:function(result){
							if(result&&result.record){
								if(null==result.record.companyId){
									banStyle("入驻企业用户可预留车位！");
								}else{
									_parseRecords(result.record);
								}
							}
						}
						});
				}else{
					//登录失败
					banStyle("请登录后，提交预约!");
				}
			})
        	
            $(document).on("click",".ru-options li" ,function(){
                $(this).addClass("active").siblings().removeClass("active");
            });
            $(".ru-more").click(function(){
                $(this).find("a").toggleClass("active");
                $(this).find("i").toggleClass("fa-angle-down fa-angle-up")
                $(this).prev().toggleClass("hauto");
            });
            //选时间
            $(".select-time input[type='text']").on("click",function(e){
                e.stopPropagation();
                $(this).next(".time-nav").toggle();               
            });
            $(".time-nav").on("click","li",function(){
                $(this).addClass("selected").siblings().removeClass("selected");
                var selecttext=$(this).text();
                var val=$(this).attr("data-val");
                $(this).parents(".time-nav").prev().val(selecttext).attr("data-val",val); 
                $(this).parents(".time-nav").hide();

            }); 
            var start = {
                elem: '#startTime',
                min: laydate.now(), //设定最小日期为当前日期
                max: '2099-06-16 23:59:59', //最大日期
                istoday: false,
                choose: function(datas){
                     end.min = datas; //开始日选好后，重置结束日的最小日期
                     end.start = datas //将结束日的初始值设定为开始日
                }
            };
            var end = {
                elem: '#endTime',
                min: laydate.now(),
                max: '2099-06-16 23:59:59',
                istoday: false,
                choose: function(datas){
                    start.max = datas; //结束日选好后，重置开始日的最大日期
                }
            };
            laydate(start);
            laydate(end);
            
           
         	
	   		//关闭提示div	
            $(".close").click(function(){
            	$(".pop_layer.pl1").hide();
            });
            $(".close-toast").click(function(){
            	$(".toast").hide();
           	});
            
            //提交方法
            $(".submit1").click(function(){
            	var isMobile=/^(?:13\d|15\d|18\d)\d{5}(\d{3}|\*{3})$/;//手机号的格式
            	var isNum = /^\+?[1-9][0-9]*$/;
            	if (!isLogin) {
					$("#msg").text("请登录后重试！");
		            $(".toast").show();
		            setTimeout('$(".toast").hide();',2000);
					return;
				} 
            	var cpEnName = $("#cpEnName").val();
            	var cpLinkMan = $("#cpLinkMan").val();
            	var cpLinkTel = $("#cpLinkTel").val();
            	var cpCount = $("#cpCount").val();
            	var cpEnAdr = $("#cpEnAdr").val();
            	if(cpEnName==''){
            		$("#msg").text("请填写企业名称");
		            $(".toast").show();
		            setTimeout('$(".toast").hide();',2000);
					return;
            	}else if(cpLinkMan==''){
            		$("#msg").text("请填写联系人");
		            $(".toast").show();
		            setTimeout('$(".toast").hide();',2000);
					return;
            	}else if(!isNum.test(cpCount)){
            		$("#msg").text("请填写车位数");
		            $(".toast").show();
		            setTimeout('$(".toast").hide();',2000);
					return;
            	}else if(cpEnAdr==''){
            		$("#msg").text("请填写公司地址");
		            $(".toast").show();
		            setTimeout('$(".toast").hide();',2000);
					return;
            	}else if(!isMobile.test(cpLinkTel)){
            		$("#msg").text("请填写正确联系方式");
		            $(".toast").show();
		            setTimeout('$(".toast").hide();',2000);
					return ;
				}else if($("#startTime").val()==''){
            		$("#msg").text("请选择开始时间");
		            $(".toast").show();
		            setTimeout('$(".toast").hide();',2000);
					return;
            	}else if($("#cpBegionTime").find("li.selected").html()==undefined){
            		$("#msg").text("请选择开始时段");
		            $(".toast").show();
		            setTimeout('$(".toast").hide();',2000);
					return;
            	}else if($("#endTime").val()==''){
            		$("#msg").text("请选择结束时间");
		            $(".toast").show();
		            setTimeout('$(".toast").hide();',2000);
					return;
            	}else if($("#cpEntdTime").find("li.selected").html()==undefined){
            		$("#msg").text("请选择结束时段");
		            $(".toast").show();
		            setTimeout('$(".toast").hide();',2000);
					return;
            	} 
            	
            	var cpEntdTime = $("#endTime").val()+" "+$("#cpEntdTime").find("li.selected").html();
            	var cpBegionTime = $("#startTime").val()+" "+$("#cpBegionTime").find("li.selected").html();
            	var e = new Date(cpEntdTime.replace(/-/g,"/")); 
            	var s = new Date(cpBegionTime.replace(/-/g,"/")); 
            	var hs = e-s;
            	var hours=Math.floor(hs/(3600*1000))
            	//订单金额： 小时*车辆数*每小时单据（25）
            	var userorderAmount = hours*cpCount*25;  
            	//提交
            	
            	$(".submit1").addClass("undis") ;
				$(".submit2").removeClass("undis") ;
            	var params = ['cpEnName='+cpEnName,'cpLinkMan='+cpLinkMan,'cpLinkTel='+cpLinkTel,'cpCount='+cpCount,'cpEntdTime='+cpEntdTime,'cpBegionTime='+cpBegionTime,'cpEnAdr='+cpEnAdr,'userorderAmount='+userorderAmount];
            	var serviceURL = baseUrl+"carportManager/saveCarport.json";
            	$.youi.ajaxUtils.ajax({
	            	url : serviceURL,
					data : params.join('&'),
					jsonp : 'data:jsonp',
					dataType : 'jsonp',
					success : function(result) {
						$(".submit1").removeClass("undis") ;
						$(".submit2").addClass("undis") ;
						$(".bg-tanc.m1").show();
						jump1(3);
						/* a=3;
						timer2=setInterval("jump1()",2000); */
					},error:function(XMLHttpRequest, textStatus, errorThrown){
						$(".submit1").removeClass("undis") ;
						$(".submit2").addClass("undis") ;
						//alert(XMLHttpRequest);
					}
            	});	
            });
        });
        
        //获得公司名字
        function _parseRecords(record){
			var rzId=record.companyId;
			var params = ['rzId='+rzId];
			var serviceURL = baseUrl+'enterbusinessmanagerRzManager/getEnterbusinessmanagerRz.json';
			$.youi.ajaxUtils.ajax({
		    url : serviceURL,
			data : params.join('&'),
			jsonp : 'data:jsonp',
			dataType : 'jsonp',
			success : function(result) {
				if(result&&result.record){
					$("#cpEnName").val(result.record.rzName);
				}
			},error:function(XMLHttpRequest, textStatus, errorThrown){
				//alert(XMLHttpRequest);
			}
		  	});	
		};
		
		//禁用样式
		function banStyle(msg){
			$("#submsg").show();
			$("#submsg").html(msg);
			$("#sub").attr("disabled","disabled");
			$("#sub").attr("style","background: #BEBEBE;width:120px;height:40px;")
		}
		
		//手动跳转
		function jump(){
			window.location=cenUrl+"member/memberCenter/personalCenter/orderCenter.html";
		}
    </script>
    
    <!-- 弹出层样式 -->
    <div class="toast">
        <div class="toast-con clearfix">
            <div class="close-toast fr"></div>
            <p class="tc mt25 f18" style="color:#ff6715" id="msg">请登录后重试！</p>
        </div>
    </div>
    
     <!-- 弹窗 -->
     <div class="bg-tanc m1">
		<div class="tanc-con" style="top:50%;margin-top:-225px;width:550px;padding:40px 30px;">
		<a href="javascript:;" class="tc-close"></a>
		<div class="tc mt40">
			<div class="mt20 mb20 f16 lh26">
				<img src="../styles/images/yqfw/correct.png" border="0" class="mr20"/>
			</div>
			<p class="mb10 f16">您已经成功提交订单，请到会员中心查看。</p>
			<p><span class="c-o f24 tc-time" id="ti-m1">3 </span>秒后，系统将自动跳转</p>
			<p class="mt10"><a style="cursor:pointer;" onclick="jump();" class="c-6">手动跳转 ></a></p>
			<div class="clearfix mt30">
				<a style="cursor:pointer;" onclick="jumpIndex();"  class="c-6"><i class="fa fa-home mr10" style="font-size:24px;"></i>返回首页</a>
				<span class="f14 ml20 mr20 c-6">|</span>
				<a style="cursor:pointer;" onclick="jumpPerson();"  class="c-6"><i class="fa fa-user mr10" style="font-size:20px;"></i>个人中心</a>
			</div>
		</div>
		</div>
	 </div>
</body>
</html>
