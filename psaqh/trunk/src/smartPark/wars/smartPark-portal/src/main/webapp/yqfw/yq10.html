<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>一卡通办理</title>
	<link href="../styles/base.css" type="text/css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="../styles/page/zs.css">
	<link rel="stylesheet" type="text/css" href="../styles/page/awesome/css/font-awesome.min.css">
	<script type="text/javascript" src="../scripts/lib/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="../scripts/lib/jquery-ui.min.js"></script>
	<script type="text/javascript" src="../scripts/lib/bootstrap.min.js"></script>
	<script type="text/javascript" src="../scripts/lib/giui.min.js"></script>
	<script type="text/javascript" src="../scripts/page/yqfwnews.js"></script>
	<script type="text/javascript" src="../scripts/page/laydate/laydate.js"></script>
	<script type="text/javascript" src="../scripts/page/pagewrapper.js"></script>
	<script>
		$(function(){
			laydate({
			    elem: '#timer', //目标元素。由于laydate.js封装了一个轻量级的选择器引擎，因此elem还允许你传入class、tag但必须按照这种方式 '#id .class'
			    format: 'YYYY-MM-DD hh:mm:ss', //日期格式
		        istime: true, //是否开启时间选择
			    event: 'focus' //响应事件。如果没有传入event，则按照默认的click
			});
		})
	</script>
</head>
<body>
	<!--***top start****************************************-->
	<div id="youi_page_header" class="youi-page-header clearfix"></div>
	<!--***top end****************************************-->
	<div class="w100">
		<div class="w1200 clearfix pt30 pb50">
			<div class="h-nav clearfix">
				<a href="">首页</a><img src="../styles/images/zs/right-j-b.png" border="0" />
				<a href="">物业服务</a><img src="../styles/images/zs/right-j-b.png" border="0" />
				<a href="" class="current">一卡通办理</a>
			</div>
			<div class="clearfix">
				<div class="fl w895">				
					<div class="ht-bd-box">
						<table class="setting-table">
							<colgroup>
								<col width="80"></col>
								<col></col>
								<col width="120"></col>
								<col></col>
							</colgroup>
							<tr>
								<td align="center">企业名称</td>
								<td><input type="text" id="ocComp"></td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<td align="center"  valign="top">地址选择</td>
								<td colspan="3" class="addressList">
									<!-- <div class="select-address active">
										<p><span>联系人：李斯李斯</span><span class="ml20">联系电话：1825598541</span></p>
										<p>园区地址：T4航站楼A302室</p>
										<em class="s-a-select"></em>
									</div>
									<div class="select-address">
										<p><span>联系人：李斯李斯</span><span class="ml20">联系电话：1825598541</span></p>
										<p>园区地址：T4航站楼A302室</p>
										<em class="s-a-select"></em>
									</div> 
									<a href="javascript:;"class="fl mt15 open-tanc"><i class="fa fa-plus-circle mr5"></i>新增地址</a> -->
								</td>
							</tr>
							<tr>
								<td align="center">预约时间</td>
								<td><input type="text" id="timer"></td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<td align="center">办理方式</td>
								<td><label><input type="radio" checked="checked" class="mr5">到营业厅去领取</label> <span class="ml20 f12 c-o">领取地址：	t6航站楼－物业管理中心</span></td>
							</tr>
							<tr>
								<td align="center" >其他说明</td>
								<td colspan="3">
									<textarea id="ocRemark"></textarea>
								</td>
							</tr>
							<tr>
								<td></td>
								<td><input value="提交" class="hhf-submit" type="submit" style="margin-left:0px;"></td>
							</tr>
						</table>
					</div>
					<h4 class="f14 mt20 mb20">一卡通办理流程</h4>	
					<div class="tc pt20 pb20" style="background-color:#f6f6f6;border:1px solid #ecebeb">
						<img src="../styles/images/yqfw/lct3.png" border="0" />
					</div>
				</div>
				<div class="fr w285" style="background-color:transparent">
					<div id="youi_page_right" class="youi-page-right clearfix"></div>
				</div>
			</div>
		</div>
	</div>
	<!--***bottom start****************************************-->
	<div id="youi_page_footer" class="youi-page-footer"></div>
	<!--***bottom end****************************************-->

	<!--***弹窗 start****************************************-->
	<div class="bg-tanc">
		<div class="tanc-con" style="top:50%;margin-top:-225px;">
			<a href="javascript:;" class="tc-close"></a>
			<h3 class="mb10"><b>新增地址</b></h3>
			<table class="line-table cic-l-t wybx-tanc">
				<colgroup>
					<col width="110"></col>
					<col></col>
				</colgroup>
				<tr class="label">
					<td><b>地址类型</b></td>
					<td>
						<label><input type="radio" name="address" class="mr5" checked="checked" value="0">园区地址</label>
						<label class="ml30"><input type="radio" name="address" class="mr5" value="1">非园区地址</label>
					</td>
				</tr>
				<tr>
					<td><b>姓名</b></td>
					<td><input type="text" id="addressName"></td>
				</tr>
				<tr>
					<td><b>电话</b></td>
					<td><input type="text" id="addressPhone"></td>
				</tr>
				<tr class="show1">
					<td><b>园区地址</b></td>
					<td>
						<div class="tct-select fl mr20 bbmbud" style="width:160px">
							<!-- <div class="ic-select">
								<p>园区地址2</p>
							</div>
							<ul style="display: none;" class="select-nav">
								<li>园区地址1</li>
								<li>园区地址2</li>
								<li>园区地址3</li>
							</ul> -->
						</div>
						<div class="tct-select fl bbmfloor" style="width:160px">
						<div class="ic-select">
								<p id="floorNo"></p>
							</div>
							<!-- 
							<ul style="display: none;" class="select-nav">
								<li>创立方1</li>
								<li>创立方2</li>
								<li>创立方3</li>
							</ul> -->
						</div>
						<div class="tct-select fl bbmfloor" style="margin-left: 20px;">
							<input type="text" id="ad1" style="width:160px;height: 29px;">
						</div>
					</td>
				</tr>
				<tr class="show2 undis">
					<td><b>地址信息</b></td>
					<td><input type="text" style="width:450px;" id="ad2"></td>
				</tr>
				<tr>
					<td></td>
					<td colspan="2"><a href="javascript:;" onclick="javascript:saveadd();" class="ib-btn" style="width:120px;text-align:center;margin-top:10px;">保存</a></td>
				</tr>
			</table>
		</div>
	</div>
	<!--***弹窗 end****************************************-->

	<script type="text/javascript" src="../scripts/page/right.js"></script>
	
	<!-- 页面数据初始化 -->
	<script type="text/javascript">
		$.youi.ajaxUtils.ajax({
			url:baseUrl+"enterpriseEmployeesManager/getEnterEmployforpage.json", 
			jsonp:'data:jsonp',
			dataType:'jsonp',
			success:function(result){
				if(result&&result.record){
					$("#ocComp").val(result.record.rz.rzName);
				}
			}
		});
	</script>
	
	<script type="text/javascript">

		$(function(){
			$(".hhf-submit").click(function(){
				if(!isLogin){alert("请登录");return;} 
				//判断是否是企业员工
				$.youi.ajaxUtils.ajax({
				url:baseUrl+"enterpriseEmployeesManager/getEnterEmployforpage.json", 
				jsonp:'data:jsonp',
				dataType:'jsonp',
				success:function(result){
					if(result&&result.record){
							var addressId = $(".select-address.active")[0].getAttribute("id");
							var time = $('#timer').val(); 
						
							 if(time=="" || time.length==0){
								alert("请输入预约时间！");
								return false;
							 }
						
							var params = ['ocComp='+$("#ocComp").val(),
										'ocDate='+time,
										//'ocWay=00',
										//'ocStatus=00',
										'ocAddree.addressId='+addressId,
										'ocRemark='+$("#ocRemark").val()];
						
							var serviceURL = baseUrl+"propertyservicemanagerOcManager/savePropertyservicemanagerOc.json";
						
							//公共方法
							$.youi.ajaxUtils.ajax({
								url:serviceURL,
								data:params.join('&'),
								jsonp:'data:jsonp',
								dataType:'jsonp',
								success:function(results){
									if(results&&results.record){
										alert("申请成功!");
										window.location=cenUrl+"member/memberCenter/propertyService/propertyManageOc.html";
									}
								}
							});
						}else{
							alert("您不是企业用户,暂时无法申请一卡通,如有疑问请与客服人员联系!");
							return false;
						}
					}
				});
			});
		});
	</script>
	
	<script type="text/javascript">
		$(function(){
			$.youi.ajaxUtils.ajax({
				url:baseUrl +"memberadrAddressManager/getMemAddforpage.json", 
				jsonp:'data:jsonp',
				dataType:'jsonp',
				success:function(result){
					if(result&&result.records){
						_parseRecords(result.records);
					}
				}
			});
		});
		//拼接地址
		function _parseRecords(record){
			var html="";
			for(var i=0;i<record.length;i++){
				if(record[i].addressStatus==0){	
				 html+="<div class='select-address active' id="+record[i].addressId+">"+
					"<p><span>联系人："+record[i].addressName+"</span><span class='ml20'>联系电话："+record[i].addressPhone+"</span></p>"+
					"<p>园区地址："+record[i].addressDetail+"</p>"+
					"<em class='s-a-select'></em>"+
					"</div>"
				}else{
					 html+="<div class='select-address' id="+record[i].addressId+">"+
						"<p><span>联系人："+record[i].addressName+"</span><span class='ml20'>联系电话："+record[i].addressPhone+"</span></p>"+
						"<p>园区地址："+record[i].addressDetail+"</p>"+
						"<em class='s-a-select'></em>"+
						"</div>"
				}
			}
			html+="<a href='javascript:;' class='fl open-tanc'><i class='fa fa-plus-circle mr5'></i>新增地址</a>";
			$(".addressList").append(html);
			activeclick();
		};
	</script>
	
	
	<!--拼接新增地址-->
	<script type="text/javascript">
		function getbbmbud(){
				//获取楼栋
				$.youi.ajaxUtils.ajax({
					url:baseUrl +"bbmBuildingManager/getBbmBuildings.json", 
					jsonp:'data:jsonp',
					dataType:'jsonp',
					success:function(result){
						if(result&&result.records){
							bbmBuild(result.records);
						}
					}
				});
			};
		
			function bbmBuild(record){
				var html="";
				html=html+"<div class='ic-select'>"+
				"<p id='buildingNo' value='"+record[0].buildingId+"'>"+record[0].buildingNo+"</p>"+
				"</div>"+
				"<ul style='display: none;' class='select-nav'>";
				for(var i=0;i<record.length;i++){
					html =html +"<li value='"+record[i].buildingId+"'>"+record[i].buildingNo+"</li>"
				}
				html =html +"</ul>";
				
				$(".bbmbud").append(html);
				liclick();
			};
			//初始化楼层地址
			function getbbmfloor(){
				 var html ="";
				 html = html +"<ul style='display: none;' class='select-nav' id='floo'>"+
				"</ul>";
				
				$(".bbmfloor").append(html);
			};
			//根据所选楼栋查询楼层信息
			function getfloor(id){
				var buildingId = id;
				var params = ['buildingId='+buildingId];
				$.youi.ajaxUtils.ajax({
					url:baseUrl +"bbmFloorManager/getBbmFloorByBuildingId.json", 
					data:params.join('&'),
					jsonp:'data:jsonp',
					dataType:'jsonp',
					success:function(result){
						if(result&&result.records){
							
							$("#floorNo").text(result.records[0].floorNo);	
							var html = "";
							$("#floo").empty();
							for(var i=0;i<result.records.length;i++){
								html =html +"<li>"+result.records[i].floorNo+"</li>"
							}
							$("#floo").append(html);
							 floorclick();
						}
					}
				});
			}	
			//保存地址
			
			function saveadd(){
				var bool = $('input[name="address"]:checked').val();
				var addressName=$("#addressName").val();	
				var addressPhone=$("#addressPhone").val();
				var addressDetail ="";
				if(bool=='0'){
					 var a1 = $("#buildingNo").text();
					 var a2 = $("#floorNo").text();
					 var a3 = $("#ad1").val();
					 addressDetail = a1+a2+a3;
				}else if(bool=='1'){
					addressDetail = $("#ad2").val();
				}
				if(!isMobil(addressPhone)){
					alert("手机号格式不正确！");
					return false;
				}
				
				var params = ['addressName='+addressName,
								'addressPhone='+addressPhone,
								'addressDetail='+addressDetail];
				var serviceURL = baseUrl+"memberadrAddressManager/saveMemberadrAddress.json";
				
				//公共方法
				$.youi.ajaxUtils.ajax({
					url:serviceURL,
					data:params.join('&'),
					jsonp:'data:jsonp',
					dataType:'jsonp',
					success:function(results){
						if(results&&results.record){
							alert("保存成功");
							location.reload();
						}
					}
				});
			};
	</script>
	
	
	<script type="text/javascript">
		function activeclick(){
			$(".select-address").click(function(){
				$(this).parent().find(".select-address").removeClass("active");
				$(this).addClass("active");
			});
			$(".open-tanc").click(function(){
				$(".bg-tanc").show();
				$(".bbmbud").empty();
				$("#floorNo").empty();
				getbbmbud();
				getbbmfloor();
			});
		};
		function liclick(){
			$(".ic-select").click(function(e){
				$(".select-nav").hide();
			    $(this).next(".select-nav").show();
			    e.stopPropagation();//阻止冒泡
			});
			$("body").click(function(){
			     $(".select-nav").hide();
			});
			$(".select-nav li").click(function(){
				$(this).parents(".tct-select").find(".ic-select p").text($(this).text()) ;
				var lival = $(this)[0].getAttribute("value");
				$(this).parents(".tct-select").find(".ic-select p")[0].setAttribute("value",lival);
				getfloor(lival);
				
				$(this).parent().hide();
			});
		};
		function floorclick(){
			$(".ic-select").click(function(e){
				$(".select-nav").hide();
			    $(this).next(".select-nav").show();
			    e.stopPropagation();//阻止冒泡
			});
			$("body").click(function(){
			     $(".select-nav").hide();
			});
			$(".select-nav li").click(function(){
				$(this).parents(".tct-select").find(".ic-select p").text($(this).text()) ;
				$(this).parent().hide();
			});
		};
		
		//校验手机号格式
		function isMobil(s) {
		    var patrn = /^(13[0-9]{9})|(14[0-9])|(18[0-9])|(15[0-9][0-9]{8})$/;
		    if (!patrn.exec(s)) return false
		    return true
		};
	</script>
</body>
</html>