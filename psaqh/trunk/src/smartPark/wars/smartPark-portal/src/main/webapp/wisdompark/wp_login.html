<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>个人登录</title>
<link href="../styles/page/awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet">
<link href="../styles/base.css" type="text/css" rel="stylesheet">
<link href="../styles/page/page.css" type="text/css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../styles/page/zs.css">
</head>

<body>
<div id="youi_page_header" class="youi-page-header clearfix"></div>
<!--***top end****************************************-->
<!--这里自己调用 页面加载动态效果-->	
 <div class="clearfix undis" id="loading">
	<div id="contain">
	    <div class='wrap' id='wrap1'>
	    	<div class='part' id='part1'></div>
	    </div>
	    
	    <div class='wrap' id='wrap2'>
	    	<div class='part' id='part2'></div>
	    </div>
	    
	    <div class='wrap' id='wrap3'>
	    	<div class='part' id='part3'></div>
	    </div>
	    
	    <div class='wrap' id='wrap4'>
	    	<div class='part' id='part4'></div>
	    </div>
	</div>
</div>				
<!--content-->
<div class="w1200 mhbg">
	<a href="virtual.html" class="inline_b ml20"><i class="fa fa-angle-left cc fa-3x"></i></a>
	<div class="hxpic">
    	<div class="hx01" title="01" >
            <div class="hx_square1 hx_tright " ></div>
            <div class="hx_square1 hx_bright"></div>
        </div>
        <div class="hx02" title="02">
            <div class="hx_square1 hx_tright "></div>
            <div class="hx_square1 hx_bright"></div>
        </div>
        <div class="hx03" title="03">
            <div class="hx_square2 hx_tright "></div>
        </div>
        <div class="hx04" title="04"></div>
        <div class="hx05" title="05"></div>
        <div class="hx06" title="06"></div>
        <div class="hx07" title="07"></div>
        <div class="hx08" title="08"></div>
        <div class="hx09" title="09"></div>
        <div class="hx10" title="10"></div>
        <div class="hx11" title="11">
            <div class="hx_square1 hx_tleft "></div>
            <div class="hx_square1 hx_bleft"></div>
        </div>
        <div class="hx12" title="12">
            <div class="hx_square1 hx_tleft "></div>
            <div class="hx_square1 hx_bleft"></div>
        </div>
    </div>
    <div class="hxinfo">
    	<table class="tabel_hx">
        	<tr><td colspan="2" class="into_tit" align="center"></td></tr>
            <tr>
            	<td>房间名称：</td>
                <td id="roomNo" align="left"></td>
            </tr>
            <tr>
            	<td>房间面积：</td>
                <td id="area" align="left"></td>
            </tr>
            <tr>
            	<td>朝&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;向：</td>
                <td id="aspect" align="left"></td>
            </tr>
            <tr>
            	<td>户&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;型：</td>
                <td id="module" align="left"></td>
            </tr>
            <tr>
            	<td>装&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;修：</td>
                <td id="furnish" align="left"></td>
            </tr>
            <tr>
            	<td>租&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;金：</td>
                <td id="price" align="left"></td>
            </tr>
        </table> 
        <div class="mt20 tc">
            <div class="btn-cheng mr25" id="tj_pop">推荐</div>
            <div class="btn-chengk">预约</div>
        </div>
        <div class="mt30">
        	<span class="f16 cc fw">装修方案</span>
            <ul class="ty_ul clearfix mt15">
            	<li>
                	<img src="../styles/images/zhyq/eg1.png"/>
                    <p class="tc mt5 f12">
                    	1200元/平方<br/>
                        <a href="javascript:;" class="cc">方案一</a>
                    </p>
                </li>
                <li>
                	<img src="../styles/images/zhyq/eg1.png"/>
                    <p class="tc mt5 f12">
                    	1800元/平方<br/>
                        <a href="javascript:;" class="cc">方案二</a>
                    </p>
                </li>
                <li>
                	<img src="../styles/images/zhyq/eg1.png"/>
                    <p class="tc mt5 f12">
                    	2000元/平方<br/>
                        <a href="javascript:;" class="cc">方案三</a>
                    </p>
                </li>
            </ul>
        </div>
    </div>
	<ul class="clearfix wl-850">
		<li><div style="background:#3c3c3c;"></div>暂无数据</li>
		<li><div style="background:#f27171;"></div>未售</li>
		<li><div style="background:#eed16e;"></div>已售招待</li>
		<li><div style="background:#76ec6d;"></div>已售已招</li>
	</ul>
</div> 
    
<!--***bottom start****************************************-->
	<div id="youi_page_footer" class="youi-page-footer"></div>
<!--***bottom end****************************************-->
<!--遮罩层-->
<div class="pop_layer">
	<div class="tj_info bgfff">
		<div id="closer"></div>
    	<div class="borderm pb10 f16">填写推荐信息</div>
        <form class="tj_form mt15">
        	<div>
        		<label>联系人姓名</label>
                <input type="text" class="ml10" id="name">
            </div>
            <div style="margin-left:84px;color: #FB7730;display:none" id="disName" class="mt10 mb10">
        		请填写联系人姓名
            </div>
            <div style="margin-left:84px" class="mt10 mb10" id="sex">
        		<i class="fa tj_radio fa-check-square-o" style="width:13px;display:inline-block" data="0"></i>&nbsp;先生
                <i class="fa fa-square-o tj_radio" style="width:13px;display:inline-block" data="1"></i>&nbsp;女士
            </div>
            <div class="mb10">
        		<label>联系人电话</label>
                <input type="text" class="ml10" id="phone">
            </div>
            <div style="margin-left:84px;color: #FB7730;display:none" id="disPhone" class="mt10 mb10">
        		请填写正确手机号
            </div>
            <div class="mb15">
        		<label>职位</label>
                <input type="text" class="ml10" id="memRole">
            </div>
            <div class="mb15">
        		<label>备注</label>
                <textarea class="ml10" id="remark"></textarea>
            </div>
            <div class="mb15">
        		<label>&nbsp;</label>
                <div class="ml10 btn-cheng" id="subReferrer">提交</div>
            </div>
        </form>
    </div>
</div>
<!--******************  code end  ****************************-->
<script type="text/javascript" src="../scripts/lib/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../scripts/lib/jquery-ui.min.js"></script>
<script type="text/javascript" src="../scripts/lib/bootstrap.min.js"></script>
<script type="text/javascript" src="../scripts/lib/giui.min.js"></script>
<script type="text/javascript" src="../scripts/page/pagewrapper.js"></script>
<script type="text/javascript" src="../scripts/page/url.js"></script>
<script>
	$(function(){
		$(".tj_radio").click(function(){
			$(this).toggleClass("fa-square-o").toggleClass("fa-check-square-o").siblings("i").addClass("fa-square-o").removeClass("fa-check-square-o");
		});
		$("#closer").click(function(){
			$(".pop_layer").hide();
		});
		$("#tj_pop").click(function(){
			$(".pop_layer").show();
		});
	});
	
</script>
<script type="text/javascript">
		 $(function(){
			$(".mhbg").hide() ;
			$("#loading").removeClass("undis") ;
			var floorId = "" ;
			floorId = getParam() ;
			var params = ["floorId="+floorId];
			$.youi.ajaxUtils.ajax({
				url:baseUrl +"bbmFloorManager/getInforByFloorId.json",//通过楼层ID获取要用的信息
				data:params.join('&'),
				jsonp:'data:jsonp',
				dataType:'jsonp',
				success:function(result){
					//console.log(result) ;
					$(".into_tit").text(result.record.html) ;
					$.youi.ajaxUtils.ajax({
						url:baseUrl +"bbmFloorManager/getRoomByFloorId.json",//通过楼层ID获取对应的楼层单元
						data:params.join('&'),
						jsonp:'data:jsonp',
						dataType:'jsonp',
						success:function(result){
							 if(result&&result.records){
								_parseRecords(result.records) ; 
								appendHtml() ;
							} 
						}
					}); 
				}
			}); 
			//推荐提交事件
			$("#subReferrer").click(function(){
				if(!isLogin){alert("请登录");return;}
				$("#disName").hide();
				$("#disPhone").hide();
				var isMobile=/^(?:13\d|15\d|18\d)\d{5}(\d{3}|\*{3})$/;//手机号的格式
				var name = $("#name").val();
				if(name==''){
					$("#disName").show();
					return false;
				}
				var phone = $("#phone").val();
				if(phone==''){
					$("#disPhone").html("手机号码不能为空");
					$("#disPhone").show();
					return false;
				}else{
					if(! isMobile.test(phone)){
						$("#disPhone").html("请填写正确手机号");
						$("#disPhone").show();
						return false;
					} 
				}		
				var memRole = $("#memRole").val();
				var memSex = "0";
				$("#sex").find("i").each(function(){
					if($(this).attr("class")=="fa tj_radio fa-check-square-o"){
						memSex = $(this).attr("data");
						return false;
					}
				})
				var remark = $("#remark").val();
				var stringData="memName="+name+"&"+"memPhone="+phone+"&"+"memRole="+memRole+"&"+"memSex="+memSex+"&"+"remark="+remark;
				var serviceURL = baseUrl+"recommendMemberManager/saveRecommendMember.json";
				$(this).html("提交中...");
				$.youi.ajaxUtils.ajax({
					url:serviceURL,
					data:stringData,
					jsonp:'data:jsonp',
					dataType:'jsonp',
					success:function(result){
						$(this).html("提交");
						alert("预约成功");
						$(".pop_layer").hide();
						$("#name").val('');
						$("#remark").val('');
						$("#memRole").val('');
						$("#phone").val('');
					},error:function(XMLHttpRequest, textStatus, errorThrown){
						alert(XMLHttpRequest);
					}
				});
			});
			
		}); 
		function getParam() { 
			var url = document.URL ; //获取页面的URL
			var param = "" ;  
			param = url.substring(url.lastIndexOf("=")+1,url.length) ; //获取页面的参数
			return param ;
		}
		function _parseRecords(record){//record为单元的list
			$(".hxpic >div").each(function(i){
					var roomNum = $(this).attr("title") ;//得到当前div的编号
					var room = roomByNo(record,roomNum) ;
					if(room){
						var status = room.status ;
						if(status == '00'){//00表示未售
							$(this).addClass("bgred") ;
						}else if(status == '01'){//01表示已售未招
							$(this).addClass("bgyellow") ;
						}else{
							$(this).addClass("bggreen") ;
						}
						$(this).attr("id",room.roomId) ;
					}else{
						$(this).addClass("bg-3c") ;
						$(this).attr("id","") ;
					} 
			});
			$("#loading").addClass("undis") ;
			$(".mhbg").show() ;
		} 
		
	 	function appendHtml(){
			$(".hxpic >div").each(function(i){
				$(this).click(function(){
					var roomId = $(this).attr("id");
					var html = "" ;
					if(roomId){
						$("#loading").removeClass("undis") ;
						var params=[
							         "roomId="+roomId
							       ];
						$.youi.ajaxUtils.ajax({
							url:baseUrl +"bbmRoomManager/getRoomByRoomId.json",
							data:params.join('&'),
							jsonp:'data:jsonp',
							dataType:'jsonp',
							success:function(results){
								var record = results.record ;
								//console.log(record) ;
								$("#loading").addClass("undis") ;
								if(record.roomNo){
									$("#roomNo").text(record.roomNo) ;
								}else{
									$("#roomNo").text("") ;
								}
								if(record.area){
									$("#area").text(record.area+" 平方米") ;
								}else{
									$("#area").text("") ;
								}
								if(record.aspect){
									$("#aspect").text(record.aspect) ;
								}else{
									$("#aspect").text("") ;
								}
								if(record.roomModule){
									$("#module").text(record.roomModule) ;
								}else{
									$("#module").text("") ;
								}
								if(record.furnish){
									$("#furnish").text(record.furnish) ;
								}else{
									$("#furnish").text("") ;
								}
								if(record.salesPrice){
									$("#price").text(record.salesPrice+"/月") ;
								}else{
									$("#price").text("") ;
								}
							}
						});
					}else{
						$("#roomNo").text("") ;
						$("#area").text("") ;
						$("#aspect").text("") ;
						$("#module").text("") ;
						$("#furnish").text("") ;
						$("#price").text("") ;
						close("暂时还没有该单元的信息哦！") ;
					}
				});
			});
			
		}
		
		function roomByNo(record,roomNum){//通过div编号得到对应的room
			for(var i=0;i<record.length;i++){
				var room = record[i] ;//得到当前单元
				var roomNo = room.roomNo ;//得到当前单元编号
				var num = roomNo.lastIndexOf("-");
				roomNo = roomNo.substring(num+1) ;//得到当前编号的后两位
				if(roomNo == roomNum){
					return record[i] ;
				}
			}
		}
		
		var pltime,timer;
        function closeTanc(){
            if(pltime>1){
                pltime--;
            }else{
                $(".toast").hide();
            }       
        }
        function close(content){
	        clearInterval(timer);
	        $(".tc.mt25.f18").empty() ;
	        $(".tc.mt25.f18").append(content) ;
	        $(".toast").show();
	        pltime=1;
	        timer=setInterval("closeTanc()",1000);
        }
	</script>
	<!-- 弹出层样式 -->
    <div class="toast">
        <div class="toast-con clearfix">
            <div class="close-toast fr"></div>
            <p class="tc mt25 f18" style="color:#ff6715"></p>
        </div>
    </div>
	
</body>
</html>
