<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>广告资源详情</title>
<link href="../styles/awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet">
<link href="../styles/base.css" type="text/css" rel="stylesheet">
<link href="../styles/page/page.css" type="text/css" rel="stylesheet">
<link href="../styles/page/dateRange.css" rel="stylesheet" type="text/css">
</head>

<body>
<div id="youi_page_header" class="youi-page-header clearfix" dataType="3" dataId="2"></div>
<!--***top end****************************************-->
<!--content-->
<div class="bgf1">
<div class="w1200 pt20">
	<ul class="linknav clearfix">
    	<li><a href="#">首页</a></li>
        <li><a href="#">园区服务</a></li>
        <li><a href="advert.html">公共资源</a></li>
        <li class="active"><a href="carLeasexq.html">广告资源详情</a></li>
    </ul>
    <div class="mt30 clearfix">
    	<div class="fl ml10"><!-- <img src="../styles/images/company/eg.png"/> --></div>
        <div class="carxq fl">
        	<span class="span_bold f20" id="commodityName"></span>
            <div class="mt20 mb20">
                <div class="res_tip" id="dw"></div>
                <div class="res_tip" id="zw"></div>
                <div class="res_tip" id="cp"></div>
			</div>
            <div class="egbg"><span id="commodityPrice">&yen;</span>元&nbsp;<span class="f16">/小时</span></div>
            <p class="f12 mt20" style="width:360px;" id="commodityDescribe">
            	此车仅供园区企业接送飞机使用<br/>
                按照每次500元计算，此价格包含60KM的油费<br/>
                师傅一名，工作2小时<br/>
                如果超公里，按照每公里3元收费，超过2小时按照每小时50元收费。
            </p>
        </div>
        <div class="fl userxq">
        	<div id="logoUrl"></div>
            <div class="mt40">
            	<img src="../styles/images/company/res_icon.png" class="mr10"/><span class="vm" id="merchantName">联系人：小周</span>
                <div class="mt10"><img src="../styles/images/company/res_ico.png" class="mr10"/><span class="vm" id="merchantPhone">联系电话：13456786986</span></div>
            </div>
        </div>
    </div>
</div><!--content***************  end-->
<div class="w1200 pt30 pb40"><!--日历选择-->
	<div class="ta_date" id="div_date1">
    	<div class="absolute_div">
            <div class="colorblock" style="background:#A2354A"></div><span class="vm">&nbsp;已预约（不可选）</span>
            <div class="colorblock" style="background:#4AA2D4"></div><span class="vm">&nbsp;空闲（可选）</span>
        </div>
        <div id="resoIds" style="display:none;"></div>
        <span id="month" style="display:none;"></span>
		<span class="date_title" id="date1"></span>
        <div class="tc mt50" id="commit">
        	<div class="btn-ck mr20" id="online">在线预约</div>
            <!-- <div class="btn-zz">立即支付</div> -->
            <div class="cc mt20">*请注意，只能选择连续的时间段</div>
        </div>
	</div>
</div><!--content***************  end-->
</div>    
    
<!--***bottom start****************************************-->
<div id="youi_page_footer" class="youi-page-footer"></div>
<!--***bottom end****************************************-->
<div class="pop_layer">
	<div class="online_box clearfix">
    	<div class="fl w95">
        	<div class="on_title">
            	<span class="span_bold f18">填写在线预约单</span>
            </div>
            <div class="cc mt15 f12">*为了保证您的旅行顺利出行，请务必填写真实信息</div>
            <form class="online_form mt20">
            	<div>
                    <div class="inline_b">
                        <label><span class="cc vm">*</span>&nbsp;联系人</label>
                        <input type="text" id="reserveName"/>
                    </div>
                    <div class="inline_b ml40">
                        <label><span class="cc vm">*</span>&nbsp;联系电话</label>
                        <input type="text" id="reserveTel"/>
                    </div>
                </div>
                <div class="mt25">
                    <div class="inline_b">
                        <label>&nbsp;&nbsp;&nbsp;联系邮箱</label>
                        <input type="text"/>
                    </div>
                    <!-- <div class="inline_b ml40">
                        <label>&nbsp;&nbsp;&nbsp;增值服务</label>
                        <input type="checkbox" class="vm"/><span class="vm c3">司机</span>
                        <label class="ib-checkbox" style="width:auto"><input type="checkbox" class="vm mr5"/>司机</label>
                    </div> -->
                </div>
                <div class="mt25">
                	<label class="vt">&nbsp;&nbsp;&nbsp;备注</label>
                    <textarea style="width:552px;height:150px"></textarea>
                </div>
                <div class="tc mt50">
                	<div class="btn-cheng" style="padding:10px 30px">提交预约</div>
                </div>
            </form>
        </div>
    	<div class="close0 fr"></div>
    </div>
</div>
<div class="toast">
        <div class="toast-con clearfix">
            <div class="close-toast fr" id="close"></div>
            <p class="tc mt25 f18" style="color:#ff6715">请选择时段</p>
        </div> 
</div>
<!--******************  code end  ****************************-->

<script type="text/javascript" src="../scripts/lib/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../scripts/lib/jquery-ui.min.js"></script>
<script type="text/javascript" src="../scripts/lib/bootstrap.min.js"></script>
<script type="text/javascript" src="../scripts/lib/giui.min.js"></script>
<script type="text/javascript" src="../scripts/page/pagewrapper.js"></script>
<script type="text/javascript" src="../scripts/page/kefu.js"></script>
<script type="text/javascript" src="../scripts/page/url.js"></script>
<script src="../scripts/page/dateRange.js"></script>
<Script  type="text/javascript">
	function GetRequest() {
   		var url = location.search; //获取url中"?"符后的字串
   		var theRequest = new Object();
   		if (url.indexOf("?") != -1) {
      		var str = url.substr(1);
      		strs = str.split("&");
      		for(var i = 0; i < strs.length; i ++) {
         		theRequest[strs[i].split("=")[0]]=(strs[i].split("=")[1]);
      		}
   		}
   		return theRequest;
	}
</Script>
<script type="text/javascript">
	$("#month").html(new Date().getMonth()+1);
	var numArray = new Array();
	var Request = new Object();
	Request = GetRequest();
	var commodityId = Request['id'];
	var params = ['commodityId='+commodityId];
	var serviceURL = baseUrl+"publicutilitiesmanagerResoManager/getPublicutilitiesmanagerResoByCommodityId.json";
	//根据商品id获取资源可用状态
	$.youi.ajaxUtils.ajax({
		url : serviceURL,
		data:params.join('&'),
		jsonp : 'data:jsonp',
		dataType : 'jsonp',
		async : false,
		success : function(results) {
			if (results && results.records) {
				var records = results.records;
				$("#resoIds").empty();
				for(var i=0; i<records.length; i++){
					$("#reserveName").val(records[0].name);
					$("#reserveTel").val(records[0].phone);
					if((Number(records[i].resoDate.substring(5,7)))==Number($("#month").html())){
						//主键追加到隐藏域供预约使用
						$("#resoIds").append(records[i].resoId+",");
						if(records[i].resoStatus=='02'){
							numArray.push(Number(records[i].resoDate.substring(records[i].resoDate.lastIndexOf("-")+1, records[i].resoDate.length)));
						}
					}
				}
			}
			//初始化pickerDateRange
			var dateRange1 = new pickerDateRange('date1', {
				aRecent30Days : true,
				needCompare : false,
				autoSubmit : false,
				inputTrigger : 'input_trigger1',
				theme : 'ta',
				autoSubmit : true,
				disCertainDate : numArray
			});
		}
	}); 
</script>
<script>
	$(function() {
		var Request = new Object();
		Request = GetRequest();
		var commodityId = Request['id'];
		var genreCode='0303';
		var params = ['commodityId='+commodityId,'genreCode='+genreCode];
		var serviceURL = baseUrl+"publicutilitiesmanagerResoManager/getPagerPublicCommoditys.json";
		$.youi.ajaxUtils.ajax({
			url : serviceURL,
			data:params.join('&'),
			jsonp : 'data:jsonp',
			dataType : 'jsonp',
			success : function(results) {
				if (results && results.records) {
					var records = results.records;
					var imageUrl="../styles/images/index/ad1.jpg";
					if(records[0].commodityImage !=null && records[0].commodityImage!=""){
						   imageUrl=cenUrl+"common/uploadImage.html?repository=/swfupload&path="+records[0].commodityImage+"&method=show";
					}
					$('.ml10').append("<img src='"+imageUrl+"' height='261' width='385'/>");
					$('#commodityName').text(records[0].commodityTitle);
					$('#commodityPrice').text(records[0].commodityPrice);
					$('#commodityDescribe').html(records[0].commodityDescribe);
					
					var logoUrl="../styles/images/company/man.png";
					if(records[0].purchasingmanagerMerchant.merchantLogo !=null && records[0].purchasingmanagerMerchant.merchantLogo!=""){
						logoUrl=cenUrl+"common/uploadImage.html?repository=/swfupload&path="+records[0].purchasingmanagerMerchant.merchantLogo+"&method=show";
					}
					$('#logoUrl').append("<img src='"+logoUrl+"' height='121' width='121'/>");
					
					$('#merchantName')
							.text("联系人：" + records[0].purchasingmanagerMerchant.merchantLinkman);
					$('#merchantPhone').text(
							"联系电话：" + records[0].purchasingmanagerMerchant.merchantLinkmanPhone);
					if (records[0].billboard != null) {
						$('#dw').text(records[0].billboard.size);
						$('#zw').text(records[0].billboard.loopType);
						$("#cp").text(records[0].billboard.unit);
					}
					
				}
			}
		});
		//关闭提示页面
		$("#close").click(function() {
			$(".toast").hide(); 
		});
		//在线预约点击事件
		$("#online").click(function() {
			var arr = new Array();
			$("#calendar .today").each(function() {
				if($(this).attr("id")!=undefined){
				var ids = $(this).attr("id");
				var idss=ids.substring(ids.indexOf("-")+1, ids.lastIndexOf("-"));
				if(idss.length==1){
					var y=ids.substring(9,ids.indexOf("-"));
					var m=idss;
					var d=ids.substring(ids.lastIndexOf("-")+1,ids.length);
					ids = y+"-0"+m+"-"+d;
					arr.push(ids);
				}else{
					ids = ids.substr(9);
					arr.push(ids);
				}
					
				}
			});
			if (arr.length > 0) {
				//获取初始化已预订日期的预约状态主键集合
				var resoIds = $("#resoIds").html();
				var resoIdArray = resoIds.substring(0, resoIds.length-1);
				//alert(resoIdArray);
				$(".pop_layer").show(); 
			}else{
				$(".toast").show(); 
			}
			
		});
		$(".close0").click(function() {
			$(".pop_layer").hide();
		});

		$(".btn-cheng").click(
						function() {
							if (!isLogin) {
								alert("请登录");
								return;
							}
							var arr = new Array();
							$("#calendar .today").each(function() {
								if($(this).attr("id")!=undefined){
								var ids = $(this).attr("id");
								var idss=ids.substring(ids.indexOf("-")+1, ids.lastIndexOf("-"));
								if(idss.length==1){
									var y=ids.substring(9,ids.indexOf("-"));
									var m=idss;
									var d=ids.substring(ids.lastIndexOf("-")+1,ids.length);
									ids = y+"-0"+m+"-"+d;
									arr.push(ids);
								}else{
									ids = ids.substr(9);
									arr.push(ids);
								}
									
								}
							});

							var reserveName=$("#reserveName").val();
							var reserveTel=$("#reserveTel").val();
							var driver='';
						    if($(".ib-checkbox").children('input[type="checkbox"]').is(":checked")){
						    	driver='01';
					          }else{
					            driver='00';
					         }
							if(reserveName ==null||reserveName==""){
								alert("请填联系人");
								return;
							}
							if(reserveTel ==null||reserveTel==""){
								alert("请填联系人电话");
								return;
							}else if(isMobil(reserveTel)){
       							
       						}else{
       							alert("电话格式不正确！");
       							return false;
       						}
							if (arr.length > 0) {
								var userorderAmount = $('#commodityPrice')
										.text();
								var string = "";
								for (var i = 0; i < arr.length; i++) {
									string += "records[" + i + "].resoDate="
											+ arr[i] + "&";
								}
								string += "userorderAmount=" + userorderAmount+"&"+"commodityId="+commodityId+"&"+"addService="+driver;
								
								var serviceURL = baseUrl+"publicutilitiesmanagerResoManager/savePublicResoOrderByList.json";
								//公共方法
							  $.youi.ajaxUtils.ajax({
									url : serviceURL,
									data : string,
									jsonp : 'data:jsonp',
									dataType : 'jsonp',
									success : function(result) {
										if (result && result.record) {
											$(".bg-tanc.m1").show();
											jump1(3);
											/* alert("预约成功");
											$(".pop_layer").hide();
											 */
										}
									},error:function(XMLHttpRequest, textStatus, errorThrown){
										alert(XMLHttpRequest);
									}
								});  
							} else {
								$(".toast").show();
							}

							//校验手机号格式
							function isMobil(s) {
							    	var patrn = /^(13[0-9]{9})|(14[0-9])|(18[0-9])|(15[0-9][0-9]{8})$/;
							   		if (!patrn.exec(s)) return false
							   	 	return true
								}
							
						});
		
		//关闭提示div	
        $("#close").click(function(){
        	$(".bg-tanc.m1").hide();
        });
		
		
	})
	
	//toast弹窗出来后，一秒自动关闭,请再调用弹窗toast的时候调用该方法
     function jump1(i){
    	$("#ti-m1").text(i);
    	i = i - 1;
		if(i>0){
			setTimeout("jump1("+i+")", 2000);
		}else{
			window.location="advertxq.html?id="+commodityId;
			//window.location=cenUrl+"member/memberCenter/personalCenter/orderCenter.html";
		}		
	} 
	
</script>

	 <!-- 弹窗 -->
     <div class="bg-tanc m1">
		<div class="tanc-con" style="top:50%;margin-top:-225px;width:550px;padding:40px 30px;">
		<a href="javascript:;" class="tc-close" id="close"></a>
		<div class="tc mt40">
			<div class="mt20 mb20 f16 lh26" >
				<img src="../styles/images/yqfw/correct.png" border="0" class="mr20"/>
			</div>
			<p class="mb10 f16">您已经成功提交订单，请到会员中心查看。</p>
			<p><span class="c-o f24 tc-time" id="ti-m1">3 </span>秒后，系统将自动跳转</p>
			<p class="mt10"><a style="cursor:pointer;" onclick="jump();" class="c-6">手动跳转 ></a></p>
			<div class="clearfix mt30">
				<a style="cursor:pointer;" onclick="jumpIndex();"  class="c-6"><i class="fa fa-home mr10" style="font-size:24px;"></i>返回首页</a>
				<span class="f14 ml20 mr20 c-6">|</span>
				<a style="cursor:pointer;" onclick="jumpPerson();"  class="c-6"><i class="fa fa-user mr10" style="font-size:20px;"></i>个人中心</a>
			</div>
		</div>
		</div>
	 </div>
</body>
</html>
