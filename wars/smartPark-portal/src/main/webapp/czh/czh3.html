<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>活动详情</title>
	<link href="../styles/base.css" type="text/css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="../styles/page/zs.css">
	<script type="text/javascript" src="../scripts/lib/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="../scripts/lib/jquery-ui.min.js"></script>
	<script type="text/javascript" src="../scripts/lib/bootstrap.min.js"></script>
	<script type="text/javascript" src="../scripts/lib/giui.min.js"></script>
	<script type="text/javascript" src="../scripts/page/pagewrapper.js"></script>
	<script type="text/javascript" src="../scripts/page/right.js"></script>
	<script type="text/javascript" src="../scripts/page/url.js"></script>	
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=0jBm0QtZ3t8BGclw0ujY0kFe"></script>
	
	<style type="text/css">
		.anchorBL{
			display:none;
		}
	</style>
</head>
<body>
	<!--***top start****************************************-->
	<div id="youi_page_header" class="youi-page-header clearfix" dataType="5" dataId="0"></div>
	<!--***top end****************************************-->
	
	<div class="w100">
		<div class="w1200 clearfix pt30 pb50">
			<div class="h-nav clearfix">
				<a href="../index.html">首页</a><img src="../styles/images/zs/right-j-b.png" border="0" />
				<a href="czh1.html">创智汇</a><img src="../styles/images/zs/right-j-b.png" border="0" />
				<a href="" class="current">活动详情页</a>
			</div>
			
			<div class="clearfix mb20">
				
				<img src="" width="470" height="272" border="0" class="fl activityImage loading"/>
				<div class="fr">
					<h3 class="h-bg"></h3>
					<div class="lh40 mt10 f14" style="color:#898989">
						<span class="mr20"><img src="../styles/images/czh/clock-l.png" border="0" class="mr10"><span class="time"></span></span>
						<span><img src="../styles/images/zs/map.png" border="0" class="mr10"><span class="address" id="activityAdr"></span></span><br/>
						<span><img src="../styles/images/czh/user-l.png" border="0" class="mr10"><span class="name"></span></span>
						
					</div>
					<div class="tel-bd clearfix">
						<img src="../styles/images/czh/logo.png" width="90" height="29" border="0" />
						<span>联系电话：</span>
						<i class="phoneNumber"></i>
					</div>
					<div class="clearfix pt20">
						<a href="javascript:;" class="a-c a-c-o">我要报名</a>
						<a href="javascript:;" class="a-c a-c-p"><img alt="收藏" src="../styles/images/czh/sc.png" border="0" class="mr5">收藏：183人</a>
						<!-- JiaThis Button BEGIN -->
							<style type="text/css">
								.jiathis_style>div{box-sizing: content-box !important;}
							</style>
							<div class="jiathis_style_24x24 fr" style="margin-top:3px">
								<span class="fl lh24">分享至：</span>
								<a class="jiathis_button_tsina"></a>
								<a class="jiathis_button_douban"></a>
								<a class="jiathis_button_renren"></a>
								<a class="jiathis_button_qzone"></a>
								<a class="jiathis_button_weixin"></a>
							</div>
							<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
						<!-- JiaThis Button END -->
					</div>
				</div>
			</div>
			<div class="clearfix">
				<div class="fl w895">				
					<div class="act-intro">活动简介</div>
					<div class="bd-box">
					</div>	
				</div>
				<div class="fr w285">
					<h2 class="lh40 f20 mt20">相关文档</h3>
					<div class="at-oh">
						<table class="article-tab" style="width:275px;table-layout:fixed">
							<colgroup>
								<col width="42"></col>
								<col width="233"></col>
							</colgroup>
							 <tr>
								<td><em>P</em></td>
								<td>
									<p>新人教版一年级语文上册13平平...</p>
									<span>暂无评价</span><span class="fr">40页</span>
								</td>
							</tr>
						</table>
					</div>
					<h2 class="f20 mt20 lh30">活动地点</h2>
					<div id="map" style="height:153px; border:1px solid #ff6715">
					
					</div>
				</div>
			</div>
			
				
		</div>
	</div>
	<!--***bottom start****************************************-->
	<div id="youi_page_footer" class="youi-page-footer"></div>
	<!--***bottom end****************************************-->
	<!-- 弹窗  start-->
	<div class="toast">
        <div class="toast-con clearfix">
            	<div class="close-toast fr"></div>
           	 <p class="tc mt25 f18" style="color:#ff6715">请登录后重试！</p>
        	</div>       
    </div>
	<div class="bg-tanc">
		<div class="tanc-con" style="top:50%;margin-top:-225px;width:400px;padding:40px 30px;">
			<a href="javascript:;" class="tc-close"></a>
			<h3 class="mb10 f20 c-333"><b>活动报名</b></h3>
			<table class="line-table cic-l-t wybx-tanc" style="font-size:12px;">
				<colgroup>
					<col width="60%">
					<col>
				</colgroup>
				<tbody>
				<tr>
					<td colspan="2"><input type="text" id="applyMember" placeholder="请输入真实姓名" style="width:100%"></td>
				</tr>
				<tr class="show2">
					<td><input type="text"  id="applyPhone" placeholder="请输入有效的手机号码" style="width:100%"></td>
					<!-- <td style="padding-left:10px;">
						<a href="javascript:;" class="send-psw" style="width:100%">发送验证码</a>
					</td> -->
				</tr>
				<!-- <tr>
					<td colspan="2">
						<input type="text" placeholder="请输入验证码" style="width:100%">
						<p style="color:#e04648" class="f12 mt5 undis">验证码错误，请重新输入验证码</p>
					</td>
				</tr> -->
				<tr>
					<td colspan="2"><input type="button" class="ib-btn" style="width:100%;margin-top:0px;" value="报名"></td>
				</tr>
			</tbody></table>
		</div>
	</div>
	<!-- 弹窗  end -->
	<script type="text/javascript" src="../scripts/page/banner.js"></script>
	<script type="text/javascript">
		$(function(){
			
			$(".slideBox").hover(function(){
	      		clearInterval(timer);
			},function(){ timer = setInterval(run,3000)});

			$("a.a-c-p").click(function(){
				$(this).css("background-color","#ecebeb");
				$(this).html('<img alt="收藏" src="../styles/images/czh/sc-o.png" border="0" class="mr10">已收藏');
			});
			$("a.a-c-o").click(function(){
				$(".bg-tanc").show();	
			});
			//根据活动主键获取相关文档
			var url=location.href; 
			var tmp1=url.split("?")[1];  
			var tmp2=tmp1.split("=")[1]; 
			var applyId=tmp2;
			var params = ['applyId='+applyId];
			var serviceURL = baseUrl+"activityApplyManager/getPublishActivityDocuments.json";
			$.youi.ajaxUtils.ajax({
				url:serviceURL,
				data:params.join('&'),
				jsonp:'data:jsonp',
				dataType:'jsonp',
				success:function(results){
					console.log(results);
					if(results&&results.records){
						_parseActivityRecords(results.records);
					}
				}
			});
			//报名提交
			$('.ib-btn').click(function(){
				 if(!isLogin){
					   clearInterval(timer);
			            $(".toast").show();
			            pltime=2;
			            timer=setInterval("closeTanc()",1000);
					 	 return false;
					}
				var url=location.href; 
				var tmp1=url.split("?")[1];  
				var tmp2=tmp1.split("=")[1]; 
				var applyId=tmp2;
				var applyMember=$("#applyMember").val();
				var applyPhone=$("#applyPhone").val();
				if(!isMobil(applyPhone)){
					clearInterval(timer);
					$(".tc.mt25").text("请输入正确的手机号！");
		           	$(".toast").show();
		           	pltime=1;
		           	timer=setInterval("closeTanc()",1000);
					return false;
				}
				var serviceURL = baseUrl+"activityApplylistManager/saveActivityApplylistForPage.json";
				var params = ['activityApply.applyId='+applyId,'applyMember='+applyMember,'applyPhone='+applyPhone];
				$.youi.ajaxUtils.ajax({
					url:serviceURL,
					data:params.join('&'),
					jsonp:'data:jsonp',
					dataType:'jsonp',
					success:function(results){
						if(results&&results.record){
							clearInterval(timer);
							$(".tc.mt25").text("报名成功!");
				         	$(".toast").show();
				         	pltime=2;
				         	timer=setInterval("closeTanc()",1000);
				         	$(".bg-tanc").hide();
						}else{
							clearInterval(timer);
							$(".tc.mt25").text("您已报名成功!");
				         	$(".toast").show();
				         	pltime=2;
				         	timer=setInterval("closeTanc()",1000);
				         	//$(".bg-tanc").hide();
						}
					}
				});	
			});
		});
		
		//校验手机号格式
		function isMobil(s) {
		    	var patrn = /^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;
		   		if (!patrn.exec(s)) return false
		   	 	return true
		};
		
		$(function(){
			var url=location.href; 
			var tmp1=url.split("?")[1];  
			var tmp2=tmp1.split("=")[1]; 
			var applyId=tmp2;
			var serviceURL = baseUrl+"activityApplyManager/getActivityApply.json";
			var params = ['applyId='+applyId];
			
			$.youi.ajaxUtils.ajax({
				url:serviceURL,
				data:params.join('&'),
				jsonp:'data:jsonp',
				dataType:'jsonp',
				success:function(results){
					if(results&&results.record){
					_parseRecords(results.record);
				
					}
				}
			});	
			//获取文档列表
			$.youi.ajaxUtils.ajax({
				url:serviceURL,
				data:params.join('&'),
				jsonp:'data:jsonp',
				dataType:'jsonp',
				success:function(results){
					if(results&&results.record){
					_parseRecords(results.record);
					}
				}
			});	
		});
		//活动详情赋值
		function _parseRecords(record){

			$(".activityImage").attr("src",cenUrl+"common/uploadImage.html?repository=/swfupload&path="+record.activityImage+"&method=show");
			$(".h-bg").html(record.applyTitle);
			$(".time").html(record.startTime);
			//$(".address").html();
			$(".name").html("发布人："+record.memberId.memberName);
			$(".phoneNumber").html(record.memberId.memberPhoneNumber);
			$(".bd-box").html(record.commentContent);
			$("#activityAdr").html(record.activityAdr);
			var map = new BMap.Map("map");//创建Map实例
			map.centerAndZoom(new BMap.Point(116.404, 39.915), 11);
			local = new BMap.LocalSearch(map, {
				renderOptions: {map: map}
			});
			//, panel: "r-result"
			local.search($("#activityAdr").html().substring(3,$("#activityAdr").html().length));
			$('#map div.anchorBL').hide();
		}
		//文档库赋值
		function _parseActivityRecords(record){
			var html='';
			for(var i=0;i<record.length;i++){
				html+="<li>"+
							"<a href='javascript:;' onclick='redirectPagePDF(this)'; id='"+record[i].documentId+"' >"+
								"<div class='in-photo'>"+
									"<img src='../styles/images/zs/nav-img1.png' border='0' width='115' height='71'>"+
								"</div>"+
								"<div class='fr'>"+
									"<p>"+record[i].documentName.split('.')[0]+"</p>"+
								"</div>"+
							"</a>"+
					 "</li>";
			}
			$('.ifn-group ul').eq(0).empty();
			$('.ifn-group ul').eq(0).append(html);
		}
		//文档跳转页面
		function redirectPagePDF(obj){
			var documentId=obj.id;
			var url="../czh/czh7.html"+"?"+"documentId="+documentId; 
			window.location.assign(url); 
		}
	</script>
	
	<script type="text/javascript">
		//toast弹窗出来后，一秒自动关闭,请再调用弹窗toast的时候调用该方法
		 var pltime,timer;
		 function closeTanc(){
		     if(pltime>1){
		         pltime--;
		     }else{
		         $(".toast").hide();
		     }       
		 };
		 //关闭toast
	        $(".close-toast").click(function(){
	            $(".toast").hide();
	        });
		 //调用方法如下，哪里调用就放哪里
		 /**
		     clearInterval(timer);
		     $(".toast").show();
		     pltime=1;
		     timer=setInterval("closeTanc()",1000);
		 */
</script>
</body>
</html>