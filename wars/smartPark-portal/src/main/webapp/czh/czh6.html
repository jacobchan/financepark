<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>知识库</title>
	<link href="../styles/base.css" type="text/css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="../styles/page/zs.css">
	<link rel="stylesheet" type="text/css" href="../styles/page/awesome/css/font-awesome.min.css">
	<script type="text/javascript" src="../scripts/lib/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="../scripts/lib/jquery-ui.min.js"></script>
	<script type="text/javascript" src="../scripts/lib/bootstrap.min.js"></script>
	<script type="text/javascript" src="../scripts/lib/giui.min.js"></script>
	<script type="text/javascript" src="../scripts/page/pagewrapper.js"></script>
	<script type="text/javascript" src="../scripts/page/right.js"></script>
	<script type="text/javascript" src="../scripts/page/url.js"></script>
	<script type="text/javascript" src="../scripts/page/jquery.page.js"></script>	
	<script type="text/javascript">
		$(function () {
			$(".czh-knowledge a:nth-child(4n) .czh-box").css("margin-right","0px");
		});
		function clickActive() {
			$(".czh-search.link a").click(function(){
				$(".czh-search.link a").removeClass("active");
				$(this).addClass("active");
				parseActivityList($(this).attr("id"),'0');
				uptime();
			});
		};
		
		
	</script>
</head>
<body>
	<!--***top start****************************************-->
	<div id="youi_page_header" class="youi-page-header clearfix" dataType="5" dataId="0"></div>
	<!--***top end****************************************-->
	<div class="w100">
		<div class="w1200 clearfix pt30 pb50">
			<div class="h-nav clearfix">
					<a href="../index.html">首页</a><img src="../styles/images/zs/right-j-b.png" border="0" />
					<a href="czh1.html">创智汇</a><img src="../styles/images/zs/right-j-b.png" border="0" />
					<a href="" class="current">知识库</a>
				</div>
			<div class="fl w895">				
				<div class="czh-search link">
					<span class="zs-span">所属活动：</span>
					<a href="javascript:;" class="a-list active">创智讲堂</a>
					<a href="javascript:;" class="a-list">创智游学</a>
					<a href="javascript:;" class="a-list">硅谷创业营</a>
					<a href="javascript:;" class="a-list">招商活动</a>
					<a href="javascript:;" class="a-list">园区公益</a>
					<a href="javascript:;" class="a-list">企业活动</a>
				</div>
				<div class="czh-search clearfix">
					<!-- <ul class="fl">
						<li class="active">综合排序</li>
						<li onclick="change()">最新 <i class="fa fa-angle-down" id="licktime"  data="0"></i></li>
						<li>最热 <i class="fa fa-angle-down"></i></li>
					</ul> -->
					<!-- <div class="fr clearfix">
						<div class="inp-box"><input type="text" placeholder="搜索"><a class="fa fa-search" href=""></a></div>
						<span class="fl mr20">1/20页</span>
						<a href="" class="a-btn"><i class="fa fa-angle-left"></i></a>
						<a href="" class="a-btn"><i class="fa fa-angle-right"></i></a>
					</div> -->
				</div>
				<div class="clearfix czh-knowledge">
					<!-- <a href="czh7.html"><div class="czh-box">
						<img src="../styles/images/czh/list-5.jpg">
						<div class="czh-group" style="border-bottom:1px solid #ecebeb">
							<h4>UI设计-VIP课堂【云中帆教育】</h4>
							<span>月观看人数：12</span>
							<span class="fr">创智讲堂</span>
						</div>
						<div class="czh-group">
							<font class="cg-soan-btn">PPT</font>
						</div>
					</div></a> -->
					
					
				</div>
				<div class="tcdPageCode fr">
					
				</div>
			</div>	
			<div class="fr w285"><div id="youi_page_right" class="youi-page-right clearfix"></div></div>
		</div>
	</div>
	<!--***bottom start****************************************-->
	<div id="youi_page_footer" class="youi-page-footer"></div>
	<!--***bottom end****************************************-->
		<script type="text/javascript">
			$(function(){
				//活动类型数据
				var serviceURL = baseUrl+"applayTypeManager/getApplayTypes.json";
				$.youi.ajaxUtils.ajax({
					url:serviceURL,
					jsonp:'data:jsonp',
					dataType:'jsonp',
					success:function(results){
						if(results&&results.records){
						_parseTypeRecords(results.records);
						initCheck();
						}
					}
				});		
			});
			//初始化类型选中
			function initCheck(){
				var url=location.href;
				var tmp1=url.split("?")[1],
					tmp2='',
					typeId='';
				if(tmp1!=null&&tmp1!=''){
					 tmp2=tmp1.split("=")[1]; 
					 typeId=tmp2;
				}
				if(typeId!=null&&typeId!=''){
					$(".czh-search.link a").removeClass("active");
					$("#"+typeId+"").addClass("active");
				}else{
					 typeId= $(".czh-search.link a").eq(0).attr('id');
					$(".czh-search.link a").removeClass("active");
					$("#"+typeId+"").addClass("active");
				}	
			  parseActivityList(typeId,'0');
			  uptime();
			}
		
			//拼接类型数据
			function _parseTypeRecords(record){
				var html='';
				html+="<span class='zs-span'>所属活动：</span>"; 
				for(var i=0;i<record.length;i++){
					if(i==0){
						html+="<a href='javascript:;' class='a-list active' id="+record[i].typeId+">"+record[i].typeName+"</li>";
					}else{
						html+="<a href='javascript:;' class='a-list' id="+record[i].typeId+">"+record[i].typeName+"</li>";
					}
				}
				$('.czh-search.link').empty();
				$('.czh-search.link').append(html);
				clickActive();
			}
			
			//拼接活动数据列表 desc:0表示默认为降序,1表示升序
			function parseActivityList(typeId,deac){
				var pageSize=8;
				var pageCount=1;	
				var typecode = typeId;
				var activeURL = baseUrl+"activityDocumentManager/getPagerActivityDocuments.json";	
				$.youi.ajaxUtils.ajax({
					url:activeURL,
					jsonp:'data:jsonp',
					data:['activityApply.applayType.typeId='+typecode].join('&'),
					dataType:'jsonp',
					success:function(results){
						pageCount=Math.ceil(results.totalCount/pageSize);
						 refreshData(1,pageSize,deac);
							$(".tcdPageCode").createPage({
							    pageCount:pageCount,
							    current:1,
							    backFn:function(p){
							       this.pageCount=pageCount;
							        refreshData(p,pageSize,deac);
							    }
							});
					}
				});	
				
				function refreshData(pageIndex,pageSize,deac){
					var params = "";
					if(deac=='0'){
						 params = {'pager:pageIndex':pageIndex,'pager:pageSize':pageSize,'activityApply.applayType.typeId':typecode,orderBy:'desc:createTime'};
					}else{
						 params = {'pager:pageIndex':pageIndex,'pager:pageSize':pageSize,'activityApply.applayType.typeId':typecode,orderBy:'asc:createTime'};
					}
					$.youi.ajaxUtils.ajax({
						url:activeURL,
						jsonp:'data:jsonp',
						data:params,
						dataType:'jsonp',
						success:function(results){
							if(results&&results.records){
								//_parseRecords(results.records);
								if(results.records.length>0){
									$(".tcdPageCode").show();
									_parseRecords(results.records);
								}else{
									$('.czh-knowledge').empty();
									$(".czh-knowledge").append('<div class="tc pt50 pb50"><img src="../styles/images/none1.png" border="0"/></div>') ;
									$(".tcdPageCode").hide();
								}
								//console.log(results);
							}
						}
					});
				}
			}
			
		function _parseRecords(record){
				//根据不同类型获取数据
				$('.czh-knowledge').empty();
				var type = $('.a-list.active').text();
				var html='';
				for(var i=0;i<record.length;i++){
					   var count =  getRandom(1000); 
					   var path = getPathtype(record[i].documentPath);
						html+="<a href='czh7.html?applyId="+record[i].activityApply.applyId+"&documendid="+record[i].documentId+"'><div class='czh-box'>"+
						"<img src='"+cenUrl+"common/uploadImage.html?repository=/swfupload&path="+record[i].activityApply.activityImage+"&method=show' style='width: 220px;height: 123px;'>"+
						"<div class='czh-group' style='border-bottom:1px solid #ecebeb'>"+
						"<h4>"+record[i].documentName.split('.')[0]+"</h4>"+
						"<span>月观看人数："+count+"</span>"+
							"<span class='fr'>"+type+"</span>"+
						"</div>"+
						"<div class='czh-group'>"+
							"<font class='cg-soan-btn'>"+path+"</font>"+
						"</div></div></a>";
					}
				$('.czh-knowledge').append(html); 
			}
		
		//初始化时间排序
		function uptime(){
			$('.czh-search.clearfix').empty();
			var html ="<ul class='fl'><li class='active'>综合排序</li>"+
				"<li onclick='change()'>最新 <i class='fa fa-angle-down' id='licktime' data='0'></i></li></ul>";
			$('.czh-search.clearfix').append(html);
		}
		//生成随机数
		function getRandom(n){
	        return Math.floor(Math.random()*n+1);
	     };
		//获取文件类型
	    function getPathtype(path){
	    	var type="";
	    	var index1=path.lastIndexOf("."); 
	    	var index2=path.length;
	    	var postf=path.substring(index1+1,index2);//后缀名  
	    	if(postf=='doc'||postf=='docx'){
	    		type="WORD";
	    	}else if(postf=='xls'||postf=='xlsx'){
	    		type="EXCEL";
	    	}else if(postf=='ppt'||postf=='pptx'){
	    		type="PPT";
	    	}
	    	return type;
	    } 
	    
		//按最新数据排序
		function change(){
			var id = $('.a-list.active').attr("id");
			if($("#licktime").attr("data")==0){
				$("#licktime").removeClass("fa-angle-down");
				$("#licktime").addClass("fa-angle-up");
				$("#licktime").attr("data","1");
				parseActivityList(id,'1');
			}else{
				$("#licktime").removeClass("fa-angle-up");
				$("#licktime").addClass("fa-angle-down");
				$("#licktime").attr("data","0");
				parseActivityList(id,'0');
			}
		}
</script>
	
</body>
</html>