<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>会议室预定详情</title>
<link href="../styles/page/awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet">
<link href="../styles/base.css" type="text/css" rel="stylesheet">
<link href="../styles/page/page.css" type="text/css" rel="stylesheet">
<link href="../styles/page/fullcalendar.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../styles/page/zs.css">
</head>

<body>
<div id="youi_page_header" class="youi-page-header clearfix" dataType="3" dataId="2"></div>
<!--***top end****************************************-->
<!--content-->
<div class="bgf1">
<div class="w1200 pt20">
	<ul class="linknav clearfix">
    	<li><a href="../index.html">首页</a></li>
        <li><a href="#">园区服务</a></li>
        <li><a href="room.html">公共资源</a></li>
        <li class="active"><a href="roomxq.html">会议室资源详情</a></li>
    </ul>
    <div class="mt30 clearfix">
    	<div class="fl ml10" id="picUrl"></div>
        <div class="carxq fl">
        	<span class="span_bold f20" id="commodityName"></span>
            <div class="mt20 mb20">
                <div class="res_tip" id="dw"></div>
                <div class="res_tip" id="zw"></div>
                <div class="res_tip" id="cp"></div>
			</div>
            <div class="egbg"><span id="commodityPrice">&yen;</span>元&nbsp;<span class="f16">/小时</span></div>
            <p class="f12 mt20" style="width:360px;" id="commodityDescribe">
            	此车仅供园区企业接送飞机使用<br/>
                按照每次500元计算，此价格包含60KM的油费<br/>
                师傅一名，工作2小时<br/>
                如果超公里，按照每公里3元收费，超过2小时按照每小时50元收费。
            </p>
        </div>
        <div class="fl userxq">
        	<div id="logoUrl"></div>
            <div class="mt40">
            	<img src="../styles/images/company/res_icon.png" class="mr10"/><span class="vm" id="merchantName">联系人：小周</span>
                <div class="mt10"><img src="../styles/images/company/res_ico.png" class="mr10"/><span class="vm" id="merchantPhone">联系电话：13456786986</span></div>
            </div>
        </div>
    </div>
</div><!--content***************  end-->

<div class="w1200 pt40 pb40"><!--选择-->
 	<div id='calendar'>
    	<div class="absolute_div">
            <div class="colorblock" style="background:#A2354A"></div><span class="vm">&nbsp;已预约（不可选）</span>
            <div class="colorblock" style="background:#4AA2D4"></div><span class="vm">&nbsp;可预约</span>
            <div class="colorblock" style="background:#C0C0C0"></div><span class="vm">&nbsp;已过期</span>
        </div>
        <div id="resoIds" style="display:none;"></div>
        <span id="month" style="display:none;">3</span>
    	<table id="data_timer">
        	 <tr>
            	<td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
            </tr>
            <tr>
            	<td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
            </tr>
            <tr>
            	<td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
            </tr>
            <tr>
            	<td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
            </tr>
            <tr>
            	<td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
            </tr>
            <tr>
            	<td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
            </tr>
            <tr>
            	<td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
            </tr>
            <tr>
            	<td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
            </tr>
            <tr>
            	<td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
            </tr>
            <tr>
            	<td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
            </tr>
           
        </table>
        <div class="tc mt50" id="commit">
        	<div class="btn-ck mr20" id="online">在线预约</div>
            <!-- <div class="btn-zz">立即支付</div> -->
            <div class="cc mt20">*请注意，只能选择连续的时间段</div>
        </div>
    </div> 
</div><!--content***************  end-->
</div>    
    
<!--***bottom start****************************************-->
	<div id="youi_page_footer" class="youi-page-footer"></div>
	
<!--***bottom end****************************************-->
<div class="pop_layer">
	<div class="online_box clearfix">
    	<div class="fl w95">
        	<div class="on_title">
            	<span class="span_bold f18">填写在线预约单</span>
            </div>
            <div class="cc mt15 f12">*为了保证您的旅行顺利出行，请务必填写真实信息</div>
            <form class="online_form mt20">
            	<div>
                    <div class="inline_b">
                        <label><span class="cc vm">*</span>&nbsp;联系人</label>
                        <input type="text" id="enteringName"/>
                    </div>
                    <div class="inline_b ml40">
                        <label><span class="cc vm">*</span>&nbsp;联系电话</label>
                        <input type="text" id="enteringTelephone"/>
                    </div>
                </div>
                <div class="mt25">
                    <div class="inline_b">
                        <label><span class="cc vm"></span>&nbsp;联系邮箱</label>
                        <input type="text"/>
                    </div>
                    <div class="inline_b ml40">
                        <label>&nbsp;&nbsp;&nbsp;增值服务</label>
                        <label class="ib-checkbox" style="width:auto"><input type="checkbox" class="vm mr5"/>茶水</label>
                    </div>
                    <!--
                       $(".btn-cheng").click(function(){
                            if($(".ib-checkbox").children('input[type="checkbox"]').is(":checked")){
                               console.log('选中')
                            }else{
                                console.log('未选中')
                            }
                        }) 
                    -->
                </div>
                <div class="mt25">
                	<label class="vt">&nbsp;&nbsp;&nbsp;备注</label>
                    <textarea style="width:552px;height:150px"></textarea>
                </div>
                <div class="tc mt50">
                	<div class="btn-cheng" style="padding:10px 30px">提交预约</div>
                </div>
            </form>
        </div>
    	<div class="close0 fr"></div>
    </div>
</div>
<!--******************  code end  ****************************-->
<script type="text/javascript" src="../scripts/lib/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../scripts/lib/jquery-ui.min.js"></script>
<script type="text/javascript" src="../scripts/lib/bootstrap.min.js"></script>
<script type="text/javascript" src="../scripts/lib/giui.min.js"></script>
<script type="text/javascript" src="../scripts/page/pagewrapper.js"></script>
<script src='../scripts/page/date_week/moment.min.js'></script>
<script src='../scripts/page/date_week/fullcalendar.min.js'></script>
<script src='../scripts/page/date_week/lang-all.js'></script>
<script type="text/javascript" src="../scripts/page/kefu.js"></script>
<script type="text/javascript" src="../scripts/page/url.js"></script>
<Script  type="text/javascript">
function GetRequest() {
   var url = location.search; //获取url中"?"符后的字串
   var theRequest = new Object();
   if (url.indexOf("?") != -1) {
      var str = url.substr(1);
      strs = str.split("&");
      for(var i = 0; i < strs.length; i ++) {
         theRequest[strs[i].split("=")[0]]=(strs[i].split("=")[1]);
      }
   }
   return theRequest;
}
</Script>
<script>

	$(document).ready(function() {
		var htmls=$("#data_timer").html();
		var currentLangCode = 'zh-cn';

		function renderCalendar() {
			$('#calendar').fullCalendar({
				header: {
					left: 'title',
					center: 'prev,next',
					right: ''
				},
				defaultView: 'agendaWeek',
				lang: currentLangCode,
				agenda: null, 
			});
		}
		
		
    	Request = GetRequest();
        var commodityId = Request['id'];
    	var params = ['commodityId='+commodityId];
    	var serviceURL = baseUrl+"publicutilitiesmanagerResoManager/getPublicutilitiesmanagerResoByCommodityId.json";
    	//根据商品id获取资源可用状态
    	$.youi.ajaxUtils.ajax({
    		url : serviceURL,
    		data:params.join('&'),
    		jsonp : 'data:jsonp',
    		dataType : 'jsonp',
    		async : false,
    		success : function(results) {
    			var numArray = new Array();
    			var numArrayDate = new Array();
    	    	var Request = new Object();
    	    	var resoTime = "";
    			if (results && results.records) {
    				var records = results.records;
    				console.log(records);
    				$("#resoIds").empty();
    				var tr=0;
    				for(var i=0; i<records.length; i++){
    					//修改前写法：var month=$(".fc-left").find('h2').html().substring(5,6)
    					// 这里在没有数据的时候一定会报空指针错误，导致原本脚本控制的样式出现问题
    					//暂时以下面方法简单判断
    					var htmlObj = $(".fc-left").find('h2').html();
    					var month=htmlObj?htmlObj.substring(5,6):0;

    					$("#enteringName").val(records[0].name);
    					$("#enteringTelephone").val(records[0].phone);
    					if((Number(records[i].resoDate.substring(5,7)))==Number(month)){
    						//主键追加到隐藏域供预约使用
    						$("#resoIds").append(records[i].resoId+",");
    						if(records[i].resoTime=='01'){
    							resoTime = "8:00-9:00";
    							tr=0;
    						}else if(records[i].resoTime=='02'){
    							resoTime = "9:00-10:00";
    							tr=1;
    						}else if(records[i].resoTime=='03'){
    							resoTime = "10:00-11:00";
    							tr=2;
    						}else if(records[i].resoTime=='04'){
    							resoTime = "11:00-12:00";
    							tr=3;
    						}else if(records[i].resoTime=='05'){
    							resoTime = "12:00-13:00";
    							tr=4;
    						}else if(records[i].resoTime=='06'){
    							resoTime = "13:00-14:00";
    							tr=5;
    						}else if(records[i].resoTime=='07'){
    							resoTime = "14:00-15:00";
    							tr=6;
    						}else if(records[i].resoTime=='08'){
    							resoTime = "15:00-16:00";
    							tr=7;
    						}else if(records[i].resoTime=='09'){
    							resoTime = "16:00-17:00";
    							tr=8;
    						}else{
    							resoTime = "17:00-18:00";
    							tr=9;
    						}
    						var resoDate=records[i].resoDate;
    						if(records[i].resoStatus=='02'){
    							var x=0;
    	    					var length=$(".fc-widget-header").find('tr').eq(0).find('th').length;
    	    					for(var q=1;q<length;q++){
    	    						var th=$(".fc-widget-header").find('tr').eq(0).find('th').eq(q).attr("data-date");
    	    						if(resoDate==th){
    	    							x=q;
    	    						}
    	    					}
    	    					if(x !=0){
    	    						numArray.push(x+"-"+tr);
    	    					}
    	    					
    						//	numArray.push(records[i].resoDate.substring(5, 10)+"日"+resoTime+"已预订\n\n");
    						//	numArrayDate.push(records[i].resoDate);
    						//	numArrayTime.push(tr);
    							
    						}
    					}
    				}
					for(var i=0;i<numArray.length;i++){
						var td=numArray[i].split("-")[0];
						var th=numArray[i].split("-")[1];
						td--;
						$("#data_timer tr").eq(th).children("td").eq(td).addClass("today");
					}
					
					//alert($("#data_timer tr").eq(tr).children("td").eq(y).text());
    			}
    		}
    	});
		
		renderCalendar();
		/**/
		var today,cursor=0;
		today=new Date().getDay();
		nowday();
		$("#data_timer").on("click","td",function(){
			if(this.className=="pasttd"){return ;}
			$(this).toggleClass("clicktd");
			
		});
		
		
		$(".fc-next-button").on("click",this,function(){
			cursor++;
			var flag=judgment();
			console.log(cursor);
			if(cursor==0){
				nowday();
				displayStatus("prev");
				return ;
				}
			if(flag){
				$("#data_timer").html(htmls);
				displayStatus("next");

			}
		});
		
		  //关闭toast
        $(".close-toast").click(function(){
            $(".toast").hide();
        })
		
		$(".fc-prev-button").on("click",this,function(){
			cursor--;
			var flag=judgment();
			console.log(cursor);
			if(cursor==0){
				nowday();
				displayStatus("prev");
			    return ;
			    }
			if(!flag){
				$("#data_timer td").addClass("pasttd");
			}
			else{
				$("#data_timer").html(htmls);
				displayStatus("next");
			}
		});
		function nowday(){
			if(today==0){today=7};
			$("#data_timer").html(htmls);
			$("#data_timer tr").each(function(index, element) {
				$(element).children("td").eq(today).prevAll("td").addClass("pasttd");
			});
		};
		function judgment(){
			var data_date=$(".fc-mon").attr("data-date");
			var date=new Date(data_date);
			var tt=Date.now();
			if(date>tt){return 1;}
			else{return 0;}
		}
		
		
        function displayStatus(name){
	    	Request = GetRequest();
	        var commodityId = Request['id'];
	    	var params = ['commodityId='+commodityId];
	    	var serviceURL = baseUrl+"publicutilitiesmanagerResoManager/getPublicutilitiesmanagerResoByCommodityId.json";
	    	//根据商品id获取资源可用状态
	    	$.youi.ajaxUtils.ajax({
	    		url : serviceURL,
	    		data:params.join('&'),
	    		jsonp : 'data:jsonp',
	    		dataType : 'jsonp',
	    		async : false,
	    		success : function(results) {
	    			var numArray1 = new Array();
					var numArrayDate1 = new Array();
			    	var Request = new Object();
			    	var resoTime = "";
	    			if (results && results.records) {
	    				var records = results.records;
	    				console.log(records);
	    				$("#resoIds").empty();
	    				var tr=0;
	    				for(var i=0; i<records.length; i++){
	    					var htmlObj = $(".fc-left").find('h2').html();
	    					var month=htmlObj?htmlObj.substring(5,6):0;
	    				//	var month=$(".fc-left").find('h2').html().substring(5,6);
	    					$("#enteringName").val(records[0].name);
	    					$("#enteringTelephone").val(records[0].phone);
	    					if((Number(records[i].resoDate.substring(5,7)))==Number(month)){
	    						//主键追加到隐藏域供预约使用
	    						$("#resoIds").append(records[i].resoId+",");
	    						if(records[i].resoTime=='01'){
	    							resoTime = "8:00-9:00";
	    							tr=0;
	    						}else if(records[i].resoTime=='02'){
	    							resoTime = "9:00-10:00";
	    							tr=1;
	    						}else if(records[i].resoTime=='03'){
	    							resoTime = "10:00-11:00";
	    							tr=2;
	    						}else if(records[i].resoTime=='04'){
	    							resoTime = "11:00-12:00";
	    							tr=3;
	    						}else if(records[i].resoTime=='05'){
	    							resoTime = "12:00-13:00";
	    							tr=4;
	    						}else if(records[i].resoTime=='06'){
	    							resoTime = "13:00-14:00";
	    							tr=5;
	    						}else if(records[i].resoTime=='07'){
	    							resoTime = "14:00-15:00";
	    							tr=6;
	    						}else if(records[i].resoTime=='08'){
	    							resoTime = "15:00-16:00";
	    							tr=7;
	    						}else if(records[i].resoTime=='09'){
	    							resoTime = "16:00-17:00";
	    							tr=8;
	    						}else{
	    							resoTime = "17:00-18:00";
	    							tr=9;
	    						}
	    						var resoDate1=records[i].resoDate;
	    						if(records[i].resoStatus=='02'){
	    							var y=0;
	    	    					var length=$(".fc-widget-header").find('tr').eq(0).find('th').length;
	    	    					for(var p=1;p<length;p++){
	    	    						var th=$(".fc-widget-header").find('tr').eq(0).find('th').eq(p).attr("data-date");
	    	    						if(resoDate1==th){
		    	    						y=p;
		    	    						if(name=="next"){
		    	    							numArray1.push(y+"-"+tr);	
		    	    						}
	    	    						}
	    	    					}
	    	    					if(name=="prev"){
	    	    						if(y !=0){
	    	    							numArray1.push(y+"-"+tr);
	        	    					}
    	    						}
	    						}
	    					}
	    				}
						for(var i=0;i<numArray1.length;i++){
							var td1=numArray1[i].split("-")[0];
							var th1=numArray1[i].split("-")[1];
							td1--;
							$("#data_timer tr").eq(th1).children("td").eq(td1).addClass("today");
						}
						
	    			}
	    		}
	    	});
    	}
	});

</script>
<script>
var commodityId;

	$(function(){
		var Request = new Object();
		Request = GetRequest();
	    commodityId=Request['id'];
		var genreCode='0301';
		var params = ['commodityId='+commodityId,'genreCode='+genreCode];
		var serviceURL = baseUrl+"publicutilitiesmanagerResoManager/getPagerPublicCommoditys.json";
	//	var serviceURL = "http://localhost:8088/smartPark-web/esb/web/purchasingmanagerCommodityManager/getPurchasingmanagerCommodity.json?commodityId="+commodityId;
		$.youi.ajaxUtils.ajax({
			url:serviceURL,
			data:params.join('&'),
			jsonp:'data:jsonp',
			dataType:'jsonp',
			success:function(results){
				if(results&&results.records){
					var records=results.records;
					var imageUrl="../styles/images/index/room.jpg";
					if(records[0].commodityImage !=null && records[0].commodityImage!=""){
						   imageUrl=cenUrl+"common/uploadImage.html?repository=/swfupload&path="+records[0].commodityImage+"&method=show";
					}
					$('#picUrl').append("<img src='"+imageUrl+"' height='261' width='385'/>");
					$('#commodityName').text(records[0].commodityTitle);
					$('#commodityPrice').text(records[0].commodityPrice);
					$('#commodityDescribe').html(records[0].commodityDescribe);
					
					var logoUrl="../styles/images/company/man.png";
					if(records[0].purchasingmanagerMerchant.merchantLogo !=null && records[0].purchasingmanagerMerchant.merchantLogo !=""){
						logoUrl=cenUrl+"common/uploadImage.html?repository=/swfupload&path="+records[0].purchasingmanagerMerchant.merchantLogo+"&method=show";
					}
					$('#logoUrl').append("<img src='"+logoUrl+"' height='121' width='121'/>");
					
					$('#merchantName').text("联系人："+records[0].purchasingmanagerMerchant.merchantLinkman);
					$('#merchantPhone').text("联系电话："+records[0].purchasingmanagerMerchant.merchantLinkmanPhone);
					if(records[0].meetingRoom.lx!= null){
						$('#dw').text(records[0].meetingRoom.lx);
					}
					if(records[0].meetingRoom.gm != null){
						$('#zw').text(records[0].meetingRoom.gm);
					}
					if(records[0].meetingRoom.tyy != null){
						if(records[0].meetingRoom.tyy=="有"){
							$('#cp').text("投影仪");
						}
						
					}
				}
			}
		});
		//在线预约
		$("#online").click(function(){
			if (!isLogin) {
			clearInterval(timer);
			$("#msg").text("请登录后重试！");
			$(".toast").show();
			pltime = 2;
			timer = setInterval("closeTanc()", 1000)
			return;
		}
			var dates=new Array();
			var times=new Array();
			var dateAndTime=new Array();
			$("#data_timer td.clicktd").not("#data_timer td.today").each(function(){
				var active=$(this).index();
				var time=$(this).html();
				if(time=='8:00-9:00'){
					time = "01";
				}else if(time == "9:00-10:00"){
					time = '02';
				}else if(time == "10:00-11:00"){
					time = '03';
				}else if(time == "11:00-12:00"){
					time = '04';
				}else if(time == "12:00-13:00"){
					time = "05";
				}else if(time == "13:00-14:00"){
					time = "06";
				}else if(time == "14:00-15:00"){
					time = "07";
				}else if(time == "15:00-16:00"){
					time = "08";
				}else if(time == "16:00-17:00"){
					time = "09";
				}else{
					time = "10";
				}
				var date=$(".fc-day-header").eq(active).attr("data-date");
				dates.push(date);//获取日期
				dateAndTime.push(date+"_"+time);//获取日期和时间段
			});
			
			if(dates.length>0){
				
				var datess=new Array();
				var dateAndTimes=new Array();
				var date0=dates[0];
				for(var i=0;i<dates.length;i++){
					//将日期去重
					if(datess.indexOf(dates[i]) == -1){
						datess.push(dates[i]);
					}
					
				}
				var a=new Array(datess.length);
				var b=new Array(datess.length);
				for(var i=0;i<datess.length;i++){
					a[i]=new Array();
					b[i]=new Array();
					//根据日期将时间段分组
					for(var j=0;j<dateAndTime.length;j++){
						if(dateAndTime[j].split("_")[0]==datess[i]){
							a[i].push(datess[i]);
							b[i].push(dateAndTime[j].split("_")[1]);//获取同一天的时间段值
						}
					}
				}
				var noContinue=new Array();
				for(var i=0;i<a.length;i++){
					var c=b[i];
			        if(c.length>1){
	                            var n = c.length;
								var min = Number(c[0]), max = Number(c[0]);
								for (var j = 1; j < n; j++) {
									//比较是时间段是否连续
									if (Number(c[j]) != 0) {
										if (min > Number(c[j]))
											min = Number(c[j]);
										if (max < Number(c[j]))
											max = Number(c[j]);
									}
								}
								if (max - min > n - 1) {
									//时间段不连续
									noContinue.push(a[i]);
								}
							}
				}

						if (noContinue.length > 0) {
							clearInterval(timer);
							$("#msg").text("请选择连续的时间段");
							$(".toast").show();
							pltime = 2;
							timer = setInterval("closeTanc()", 1000)
						} else {
							$(".pop_layer").show();
							$(".pop_layer.pl1").hide();
						}

					} else {
						clearInterval(timer);
						$("#msg").text("请选择预约日期和时间段");
						$(".toast").show();
						pltime = 2;
						timer = setInterval("closeTanc()", 1000)

					}
					//alert("已预约id："+$("#resoIds").html().substring(0,$("#resoIds").html().length-1));

				});
		$(".close0").click(function() {
			$(".pop_layer").hide();
		});
		//提交预约
		$('.btn-cheng')
				.click(
						function() {
							if (!isLogin) {
								clearInterval(timer);
								$("#msg").text("请登录后重试！");
								$(".toast").show();
								pltime = 2;
								timer = setInterval("closeTanc()", 1000)
								return;
							}
							var enteringName = $("#enteringName").val();
							var enteringTelephone = $("#enteringTelephone")
									.val();
							var tea = false;
							if ($(".ib-checkbox").children(
									'input[type="checkbox"]').is(":checked")) {
								tea = true;
							}
							if (enteringName == null || enteringName == "") {
								clearInterval(timer);
								$("#msg").text("请填写联系人");
								$(".toast").show();
								pltime = 2;
								timer = setInterval("closeTanc()", 1000)
								return;
							}
							if (enteringTelephone != null
									&& enteringTelephone != "") {
								if (isMobil(enteringTelephone)) {

								} else {
									clearInterval(timer);
									$("#msg").text("电话格式不正确！");
									$(".toast").show();
									pltime = 2;
									timer = setInterval("closeTanc()", 1000)
									return;
								}
							} else {
								clearInterval(timer);
								$("#msg").text("请填写联系人电话");
								$(".toast").show();
								pltime = 2;
								timer = setInterval("closeTanc()", 1000)
								return;
							}

							var dates = new Array();
							var times = new Array();
							$("#data_timer td.clicktd").each(
									function() {
										var active = $(this).index();
										var time = $(this).html();
										if (time == '8:00-9:00') {
											time = "01";
										} else if (time == "9:00-10:00") {
											time = '02';
										} else if (time == "10:00-11:00") {
											time = '03';
										} else if (time == "11:00-12:00") {
											time = '04';
										} else if (time == "12:00-13:00") {
											time = "05";
										} else if (time == "13:00-14:00") {
											time = "06";
										} else if (time == "14:00-15:00") {
											time = "07";
										} else if (time == "15:00-16:00") {
											time = "08";
										} else if (time == "16:00-17:00") {
											time = "09";
										} else {
											time = "10";
										}
										var date = $(".fc-day-header").eq(
												active).attr("data-date");
										dates.push(date);
										times.push(time);
									});
							if (dates.length > 0) {
								var length = dates.length;
								var userorderAmount = $('#commodityPrice')
										.text();
								userorderAmount = userorderAmount * length;
								var string = "";
								for (var i = 0; i < dates.length; i++) {
									string += "records[" + i + "].resoDate="
											+ dates[i] + "&";
								}
								for (var i = 0; i < times.length; i++) {
									string += "records[" + i + "].resoTime="
											+ times[i] + "&";
								}
								string += "userorderAmount=" + userorderAmount
										+ "&" + "commodityId=" + commodityId
										+ "&" + "addService=" + tea;
								var serviceURL = baseUrl
										+ "publicutilitiesmanagerResoManager/savePublicResoOrderByList.json";
								//公共方法
								$.youi.ajaxUtils.ajax({
									url : serviceURL,
									data : string,
									jsonp : 'data:jsonp',
									dataType : 'jsonp',
									success : function(result) {
										if (result && result.record) {
											$(".pop_layer").hide();
											$(".bg-tanc.m1").show();
											$('#ti-m1').text('5');
											a = 5;
											timer1 = setInterval("jump1()",
													1000);
											//	window.location="roomxq.html?id="+commodityId;
										}
									},
									error : function(XMLHttpRequest,
											textStatus, errorThrown) {
										$(".pop_layer").hide();
										$("#errorText").text(XMLHttpRequest);
										$(".bg-tanc.m2").show();
										$('#ti-m2').text('5');
										b = 5;
										timer2 = setInterval("jump2()", 1000);
									}
								});
							} else {
								clearInterval(timer);
								$("#msg").text("请选择预约日期和时间段");
								$(".toast").show();
								pltime = 2;
								timer = setInterval("closeTanc()", 1000)
							}

							//校验手机号格式
							function isMobil(s) {
								var patrn = /^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;
								if (!patrn.exec(s))
									return false
								return true
							}

						});

		$(".tc-close").click(function() {
			$(".bg-tanc").hide();
			clearInterval(timer1);
			clearInterval(timer2);
		});

	});
	var a, b, timer1, timer2;
	function jump1() {
		if (a > 1) {
			a--;
			$("#ti-m1").text(a);
		} else {
			window.location = cenUrl
					+ "member/memberCenter/personalCenter/orderCenter.html";
		}
	}
	function jump2() {
		if (b > 1) {
			b--;
			$("#ti-m2").text(b);
		} else {
			window.location = "roomxq.html?id=" + commodityId;
		}
	}

	//跳转订单中心
	function jumpOrder() {
		window.location = cenUrl
				+ "member/memberCenter/personalCenter/orderCenter.html";
	}
	//返回
	function jumpBack() {
		window.location = "roomxq.html?id=" + commodityId;
	}
	//toast弹窗出来后，一秒自动关闭,请再调用弹窗toast的时候调用该方法
	var pltime, timer;
	function closeTanc() {
		if (pltime > 1) {
			pltime--;
		} else {
			$(".toast").hide();
		}
	}
</script>

   <!-- 弹出层样式 -->
    <div class="toast">
        <div class="toast-con clearfix">
            <div class="close-toast fr"></div>
            <p class="tc mt25 f18" style="color:#ff6715" id="msg">请登录后重试！</p>
        </div>
        
    </div>
    
    <!-- 弹窗 -->
    <div class="pop_layer pl1">
        <div class="online_box clearfix" style="width:550px;height:212px;margin-left:-275px;margin-top:-111px;padding:30px;">
            <div class="close0 fr"></div>
            <table class="w100 mt40 c3">
                <tr>
                    <td width="28%" align="right"><img src="../styles/images/grzx/check.png" class="mr40 mb20" border="0"></td>
                    <td >
                        <h4 class="f24 c-333"> 您已预约成功！</h4>
                        <p class="f14 cc mt20 mb20">如有问题，请拨打：0571-86508888</p>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    	<!--***弹窗 start****************************************-->
	<div class="bg-tanc m1">
		<div class="tanc-con" style="top:50%;margin-top:-225px;width:550px;padding:40px 30px;">
			<a href="javascript:;" class="tc-close"></a>
			<div class="tc mt40">
				<div class="mt20 mb20 f16 lh26">
					<img src="../styles/images/yqfw/correct.png" border="0" class="mr20"/>
				</div>
				<p class="mb10 f16">您已经成功提交申请，请到会员中心查看申请状态。</p>
				<p><span class="c-o f24 tc-time mr5" id="ti-m1">5 </span>秒后，系统将自动跳转</p>
				<!-- <p class="mt10"><a href="" class="c-6">手动跳转 ></a></p> -->
				<div class="clearfix mt15 pt15" style="border-top:1px solid #efecec">
					<a style="cursor:pointer;" onclick="jumpOrder();" class="ib-btn" style="width:120px;">前往查看</a>
					<span class="ml30 mr30"></span>
					<a style="cursor:pointer;" onclick="jumpBack();"  class="ib-btn fs-btn" style="width:120px;">返回</a>
				</div>
			</div>
		</div>
	</div>
	<div class="bg-tanc m2">
		<div class="tanc-con" style="top:50%;margin-top:-225px;width:550px;padding:40px 30px;">
			<a href="javascript:;" class="tc-close"></a>
			<div class="tc mt40">
				<div class="mt20 mb20 f16 lh26">
					<img src="../styles/images/yqfw/error.png" border="0" class="mr20"/>
				</div>
				<p class="mb10 f16" id="errorText">你还不是园区内的企业用户，无法进行物业报修操作！</p>
				<p><span class="c-o f24 tc-time mr5" id="ti-m2">5</span>秒后，系统将自动跳转 <a href="" class="c-b1 ml10">手动跳转 ></a></p>
			</div>
		</div>
	</div>
</body>
</html>
