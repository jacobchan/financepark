<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>会议室预定详情</title>
<link href="../styles/base.css" type="text/css" rel="stylesheet">
<link href="../styles/page/page.css" type="text/css" rel="stylesheet">
<link href="../styles/page/fullcalendar.css" rel="stylesheet" type="text/css">
</head>

<body>
<div id="youi_page_header" class="youi-page-header clearfix"></div>
<!--***top end****************************************-->
<!--content-->
<div class="bgf1">
<div class="w1200 pt20">
	<ul class="linknav clearfix">
    	<li><a href="#">首页</a></li>
        <li><a href="#">企业服务</a></li>
        <li><a href="carLease.html">公共资源</a></li>
        <li class="active"><a href="carLeasexq.html">广告资源详情</a></li>
    </ul>
    <div class="mt30 clearfix">
    	<div class="fl ml10"></div>
        <div class="carxq fl">
        	<span class="span_bold f20" id="commodityName"></span>
            <div class="mt20 mb20">
                <div class="res_tip" id="dw">自动挡</div>
                <div class="res_tip" id="zw">9人座</div>
                <div class="res_tip" id="cp">车牌：杭AL8899</div>
			</div>
            <div class="egbg"><span id="commodityPrice">&yen;</span>元&nbsp;<span class="f16">/小时</span></div>
            <p class="f12 mt20" style="width:360px;" id="commodityDescribe">
            	此车仅供园区企业接送飞机使用<br/>
                按照每次500元计算，此价格包含60KM的油费<br/>
                师傅一名，工作2小时<br/>
                如果超公里，按照每公里3元收费，超过2小时按照每小时50元收费。
            </p>
        </div>
        <div class="fl userxq">
        	<div><img src="../styles/images/company/man.png"/></div>
            <div class="mt40">
            	<img src="../styles/images/company/res_icon.png" class="mr10"/><span class="vm" id="merchantName">联系人：小周</span>
                <div class="mt10"><img src="../styles/images/company/res_ico.png" class="mr10"/><span class="vm" id="merchantPhone">联系电话：13456786986</span></div>
            </div>
        </div>
    </div>
</div><!--content***************  end-->

<div class="w1200 pt40 pb40"><!--选择-->
 	<div id='calendar'>
    	<div class="absolute_div">
            <div class="colorblock" style="background:#A2354A"></div><span class="vm">&nbsp;已预约（不可选）</span>
            <div class="colorblock" style="background:#4AA2D4"></div><span class="vm">&nbsp;可预约</span>
            <div class="colorblock" style="background:#C0C0C0"></div><span class="vm">&nbsp;已过期</span>
        </div>
        <div id="resoIds" style="display:none;"></div>
        <span id="month" style="display:none;">3</span>
    	<table id="data_timer">
        	 <tr>
            	<td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
                <td>8:00-9:00</td>
            </tr>
            <tr>
            	<td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
                <td>9:00-10:00</td>
            </tr>
            <tr>
            	<td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
                <td>10:00-11:00</td>
            </tr>
            <tr>
            	<td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
                <td>11:00-12:00</td>
            </tr>
            <tr>
            	<td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
                <td>12:00-13:00</td>
            </tr>
            <tr>
            	<td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
                <td>13:00-14:00</td>
            </tr>
            <tr>
            	<td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
                <td>14:00-15:00</td>
            </tr>
            <tr>
            	<td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
                <td>15:00-16:00</td>
            </tr>
            <tr>
            	<td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
                <td>16:00-17:00</td>
            </tr>
            <tr>
            	<td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
                <td>17:00-18:00</td>
            </tr>
           
        </table>
        <div class="tc mt50" id="commit">
        	<div class="btn-ck mr20" id="online">在线预约</div>
            <div class="btn-zz">立即支付</div>
            <div class="cc mt20">*请注意，只能选择连续的时间段</div>
        </div>
    </div> 
</div><!--content***************  end-->
</div>    
    
<!--***bottom start****************************************-->
	<div id="youi_page_footer" class="youi-page-footer"></div>
<!--***bottom end****************************************-->
<div class="pop_layer">
	<div class="online_box clearfix">
    	<div class="fl w95">
        	<div class="on_title">
            	<span class="span_bold f18">填写在线预约单</span>
            </div>
            <div class="cc mt15 f12">*为了保证您的旅行顺利出行，请务必填写真实信息</div>
            <form class="online_form mt20">
            	<div>
                    <div class="inline_b">
                        <label><span class="cc vm">*</span>&nbsp;联系人</label>
                        <input type="text" id="enteringName"/>
                    </div>
                    <div class="inline_b ml40">
                        <label><span class="cc vm">*</span>&nbsp;联系电话</label>
                        <input type="text" id="enteringTelephone"/>
                    </div>
                </div>
                <div class="mt25">
                    <div class="inline_b">
                        <label><span class="cc vm">*</span>&nbsp;联系邮箱</label>
                        <input type="text"/>
                    </div>
                    <div class="inline_b ml40">
                        <label>&nbsp;&nbsp;&nbsp;增值服务</label>
                        <label class="ib-checkbox" style="width:auto"><input type="checkbox" class="vm mr5"/>茶水</label>
                    </div>
                    <!--
                       $(".btn-cheng").click(function(){
                            if($(".ib-checkbox").children('input[type="checkbox"]').is(":checked")){
                               console.log('选中')
                            }else{
                                console.log('未选中')
                            }
                        }) 
                    -->
                </div>
                <div class="mt25">
                	<label class="vt">&nbsp;&nbsp;&nbsp;备注</label>
                    <textarea style="width:552px;height:150px"></textarea>
                </div>
                <div class="tc mt50">
                	<div class="btn-cheng" style="padding:10px 30px">提交预约</div>
                </div>
            </form>
        </div>
    	<div class="close0 fr"></div>
    </div>
</div>
<!--******************  code end  ****************************-->
<script type="text/javascript" src="../scripts/lib/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="../scripts/lib/jquery-ui.min.js"></script>
<script type="text/javascript" src="../scripts/lib/bootstrap.min.js"></script>
<script type="text/javascript" src="../scripts/lib/giui.min.js"></script>
<script type="text/javascript" src="../scripts/page/pagewrapper.js"></script>
<script src='../scripts/page/date_week/moment.min.js'></script>
<script src='../scripts/page/date_week/fullcalendar.min.js'></script>
<script src='../scripts/page/date_week/lang-all.js'></script>
<script type="text/javascript" src="../scripts/page/kefu.js"></script>
<script type="text/javascript" src="../scripts/page/url.js"></script>
<Script  type="text/javascript">
function GetRequest() {
   var url = location.search; //获取url中"?"符后的字串
   var theRequest = new Object();
   if (url.indexOf("?") != -1) {
      var str = url.substr(1);
      strs = str.split("&");
      for(var i = 0; i < strs.length; i ++) {
         theRequest[strs[i].split("=")[0]]=(strs[i].split("=")[1]);
      }
   }
   return theRequest;
}
</Script>
<script>

	$(document).ready(function() {
		var htmls=$("#data_timer").html();
		var currentLangCode = 'zh-cn';

		function renderCalendar() {
			$('#calendar').fullCalendar({
				header: {
					left: 'title',
					center: 'prev,next',
					right: ''
				},
				defaultView: 'agendaWeek',
				lang: currentLangCode,
				agenda: null, 
			});
		}
		
		var numArray = new Array();
    	var Request = new Object();
    	var resoTime = "";
    	Request = GetRequest();
    	var commodityId = Request['id'];
    	var params = ['commodityId='+commodityId];
    	var serviceURL = baseUrl+"publicutilitiesmanagerResoManager/getPublicutilitiesmanagerResoByCommodityId.json";
    	//根据商品id获取资源可用状态
    	$.youi.ajaxUtils.ajax({
    		url : serviceURL,
    		data:params.join('&'),
    		jsonp : 'data:jsonp',
    		dataType : 'jsonp',
    		async : false,
    		success : function(results) {
    			if (results && results.records) {
    				var records = results.records;
    				$("#resoIds").empty();
    				for(var i=0; i<records.length; i++){
    					$("#enteringName").val(records[0].name);
    					$("#enteringTelephone").val(records[0].phone);
    					if((Number(records[i].resoDate.substring(5,7)))==Number($("#month").html())){
    						//主键追加到隐藏域供预约使用
    						$("#resoIds").append(records[i].resoId+",");
    						if(records[i].resoTime=='01'){
    							resoTime = "8:00-9:00";
    						}else if(records[i].resoTime=='02'){
    							resoTime = "9:00-10:00";
    						}else if(records[i].resoTime=='03'){
    							resoTime = "10:00-11:00";
    						}else if(records[i].resoTime=='04'){
    							resoTime = "11:00-12:00";
    						}else if(records[i].resoTime=='05'){
    							resoTime = "12:00-13:00";
    						}else if(records[i].resoTime=='06'){
    							resoTime = "13:00-14:00";
    						}else if(records[i].resoTime=='07'){
    							resoTime = "14:00-15:00";
    						}else if(records[i].resoTime=='08'){
    							resoTime = "15:00-16:00";
    						}else if(records[i].resoTime=='09'){
    							resoTime = "16:00-17:00";
    						}else{
    							resoTime = "17:00-18:00";
    						}
    						if(records[i].resoStatus=='02'){
    							numArray.push(records[i].resoDate.substring(5, 10)+"日"+resoTime+"已预订\n\n");
    						}
    					}
    				}
    			//	alert(numArray.toString().replace(",",""));
    			}
    		}
    	});
		
		renderCalendar();
		/**/
		var today,cursor=0;
		today=new Date().getDay();
		nowday();
		$("#data_timer").on("click","td",function(){
			if(this.className=="pasttd"){return ;}
			$(this).toggleClass("clicktd");
		});
		
		$(".fc-next-button").on("click",this,function(){
			cursor++;
			var flag=judgment();
			console.log(cursor);
			if(cursor==0){nowday();return ;}
			if(flag){
				$("#data_timer").html(htmls);
			}
		});
		$(".fc-prev-button").on("click",this,function(){
			cursor--;
			var flag=judgment();
			console.log(cursor);
			if(cursor==0){nowday();return ;}
			if(!flag){
				$("#data_timer td").addClass("pasttd");
			}
			else{
				$("#data_timer").html(htmls);
			}
		});
		function nowday(){
			if(today==0){today=7};
			$("#data_timer").html(htmls);
			$("#data_timer tr").each(function(index, element) {
				$(element).children("td").eq(today).prevAll("td").addClass("pasttd");
			});
		};
		function judgment(){
			var data_date=$(".fc-mon").attr("data-date");
			var date=new Date(data_date);
			var tt=Date.now();
			if(date>tt){return 1;}
			else{return 0;}
		}
	});

</script>
<script>
	$(function(){
		var Request = new Object();
		Request = GetRequest();
		var commodityId=Request['id'];
		var genreCode='0301';
		var params = ['commodityId='+commodityId,'genreCode='+genreCode];
		var serviceURL = baseUrl+"publicutilitiesmanagerResoManager/getPagerPublicCommoditys.json";
	//	var serviceURL = "http://localhost:8088/smartPark-web/esb/web/purchasingmanagerCommodityManager/getPurchasingmanagerCommodity.json?commodityId="+commodityId;
		$.youi.ajaxUtils.ajax({
			url:serviceURL,
			data:params.join('&'),
			jsonp:'data:jsonp',
			dataType:'jsonp',
			success:function(results){
				if(results&&results.records){
					var records=results.records;
					var imageUrl="../styles/images/index/room.jpg";
					if(records[0].commodityImage !=null && records[0].commodityImage!=""){
						   imageUrl=cenUrl+"common/uploadImage.html?repository=/swfupload&path="+records[0].commodityImage+"&method=show";
					}
					$('.ml10').append("<img src='"+imageUrl+"' height='261' width='385'/>");
					$('#commodityName').text(records[0].commodityTitle);
					$('#commodityPrice').text(records[0].commodityPrice);
					$('#commodityDescribe').html(records[0].commodityDescribe);
					$('#merchantName').text("联系人："+records[0].purchasingmanagerMerchant.merchantLinkman);
					$('#merchantPhone').text("联系电话："+records[0].purchasingmanagerMerchant.merchantLinkmanPhone);
					if(records[0].meetingRoom.lx!= null){
						$('#dw').text(records[0].meetingRoom.lx);
					}
					if(records[0].meetingRoom.gm != null){
						$('#zw').text(records[0].meetingRoom.gm);
					}
					if(records[0].meetingRoom.tyy != null){
						if(records[0].meetingRoom.tyy=="有"){
							$('#cp').text("投影仪");
						}
						
					}
				}
			}
		});
		
		$("#online").click(function(){
			//alert("已预约id："+$("#resoIds").html().substring(0,$("#resoIds").html().length-1));
			$(".pop_layer").show();
		});
		$(".close0").click(function(){
			$(".pop_layer").hide();
		});
		  //提交预约
		$('.btn-cheng').click(function(){
			if(!isLogin){alert("请登录");return;}
			var enteringName=$("#enteringName").val();
			var enteringTelephone=$("#enteringTelephone").val();
			var tea='';
		    if($(".ib-checkbox").children('input[type="checkbox"]').is(":checked")){
		    	tea='01';
	          }else{
	            tea='00';
	         }
            if(enteringName == null||enteringName == ""){
				alert("请填写联系人!");
				return;
			}
            if(enteringTelephone !=null&& enteringTelephone!=""){
				 if(isMobil(enteringTelephone)){
						
					}else{
						alert("电话格式不正确！");
						return false;
					}
		    	}else{
		    		alert("请填写联系人电话");
				return;
		    	}
			
			
			
			var dates=new Array();
			var times=new Array();
			$("#data_timer td.clicktd").each(function(){
				var active=$(this).index();
				var time=$(this).html();
				if(time=='8:00-9:00'){
					time = "01";
				}else if(time == "9:00-10:00"){
					time = '02';
				}else if(time == "10:00-11:00"){
					time = '03';
				}else if(time == "11:00-12:00"){
					time = '04';
				}else if(time == "12:00-13:00"){
					time = "05";
				}else if(time == "13:00-14:00"){
					time = "06";
				}else if(time == "14:00-15:00"){
					time = "07";
				}else if(time == "15:00-16:00"){
					time = "08";
				}else if(time == "16:00-17:00"){
					time = "09";
				}else{
					time = "10";
				}
				var date=$(".fc-day-header").eq(active).attr("data-date");
				dates.push(date);
				times.push(time);
			});
			if(dates.length>0){
        		var userorderAmount=$('#commodityPrice').text();
				var string ="";
				for(var i=0;i<dates.length;i++){
					string+="records["+i+"].resoDate="+dates[i]+"&";
				}
				for(var i=0;i<times.length;i++){
					string+="records["+i+"].resoTime="+times[i]+"&";
				}
				string+="userorderAmount="+userorderAmount+"&"+"commodityId="+commodityId+"&"+"addService="+tea;
			   var serviceURL =baseUrl+"publicutilitiesmanagerResoManager/savePublicResoOrderByList.json";
				//公共方法
			 $.youi.ajaxUtils.ajax({
					url:serviceURL,
					data:string,
					jsonp:'data:jsonp',
					dataType:'jsonp',
					success:function(result){
						if(result&&result.record){
							alert("预约成功");
							$(".pop_layer").hide();
							window.location="roomxq.html?id="+commodityId;
						}
					},error:function(XMLHttpRequest, textStatus, errorThrown){
						alert(XMLHttpRequest);
					}
				});
            }else{
            	alert("请选择预约日期和时间段");
            }	
			
			//校验手机号格式
			function isMobil(s) {
			    	var patrn = /^(13[0-9]{9})|(14[0-9])|(18[0-9])|(15[0-9][0-9]{8})$/;
			   		if (!patrn.exec(s)) return false
			   	 	return true
				}
		});
		
	})
</script>
</body>
</html>
