<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>在线预约</title>
	<link href="../styles/base.css" type="text/css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="../styles/page/zs.css">
	<link rel="stylesheet" type="text/css" href="../styles/page/awesome/css/font-awesome.min.css">
	<script type="text/javascript" src="../scripts/lib/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="../scripts/lib/jquery-ui.min.js"></script>
	<script type="text/javascript" src="../scripts/lib/bootstrap.min.js"></script>
	<script type="text/javascript" src="../scripts/lib/giui.min.js"></script>
	<script type="text/javascript" src="../scripts/page/url.js"></script>
	<script type="text/javascript" src="../scripts/page/pagewrapper.js"></script>
	
</head>
<body style="background-color:#f4f4f4;">
	<!--***top start****************************************-->
	<div id="youi_page_header" class="youi-page-header clearfix" dataType="3" dataId="0"></div>
	<!--***top end****************************************-->
	<div class="w100">
		<div class="w1200 clearfix pt30 pb50">
			<div class="h-nav clearfix">
				<a href="../index.html">首页</a><img src="../styles/images/zs/right-j-b.png" border="0" />
				<a href="yq13.html">入驻服务</a><img src="../styles/images/zs/right-j-b.png" border="0" />
				<!-- <a href="yq5.html">入驻申请</a><img src="../styles/images/zs/right-j-b.png" border="0" /> -->
				<a href="" class="current">在线预约</a>
			</div>
			<Script  type="text/javascript">
function GetRequest() {
   var url = location.search; //获取url中"?"符后的字串
   var theRequest = new Object();
   if (url.indexOf("?") != -1) {
      var str = url.substr(1);
      strs = str.split("&");
      for(var i = 0; i < strs.length; i ++) {
         theRequest[strs[i].split("=")[0]]=(strs[i].split("=")[1]);
      }
   }
   return theRequest;
}
</Script>
			<script>
			var Request = new Object();
	    	Request = GetRequest();
	    	var enteringType = Request['enteringType'];
	    	var a,b;
				$(function(){
					var j=0,num=0,pageCount=1;
					var timer1,timer2;
					var o=$(".ht-table tr th").length;//得到th有多少个；
					var dd,dm,dt,dw;
					var weekDay = ["星期天", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"];//将得到的0-7转化为星期
					changeDate(num,1000);
					//鼠标移上去时出现左右按钮
					$(".pr").hover(function(){
						$(this).children(".ht-table").nextAll().toggle();
					});
					//左按钮
					$(".cd-prev").click(function(){
						var n=$(this).parent().find(".ht-table th").eq(1).text().replace(/[^0-9]/ig,"-");//取得第一个th里的时间
						var m1=n.split("-")[0];
						var d1=n.split("-")[1];
						dd = new Date();
					  	dm=dd.getMonth()+1;
					  	dt=dd.getDate();
					  	if(m1==dm && d1==dt){
					  		clearInterval(timer);
					  		$("#msg").text("只能选择今天及以后的日期");
				            $(".toast").show();
				            pltime=1;
				            timer=setInterval("closeTanc()",1000);
					  	}else{
					  		num--;
					  		var serviceURL = baseUrl+"propertyservicemanagerEnteringManager/getEnteringList.json";
							var pageIndex=num+1;
							pageCount=$("#pageTotal").val();
							var pageSize=12;
							var params = ['pager:pageIndex='+pageIndex,'pager:pageSize='+pageSize];
							var enteringId;
							//根据商品id获取资源可用状态
							$.youi.ajaxUtils.ajax({
								url : serviceURL,
								jsonp : 'data:jsonp',
								data:params.join('&'),
								dataType : 'jsonp',
								async : false,
								success : function(results) {
									if (results && results.records) {
										pageCount=Math.ceil(results.totalCount/pageSize);
										var record = results.records;
										$("#am").empty();
										$("#pm").empty();
										var amHtml="<td>09：00-12：00</td><td><a href='javascript:;' class='em3'><span id='enteringId' style='display:none'>99</span>不可预约</a></td>";
										var pmHtml="<td>14：00-17：00</td><td><a href='javascript:;' class='em3'>不可预约</a></td>";
										$("#am").append(amHtml);
										$("#pm").append(pmHtml);
										var html="";
										var htmls="";
										for(var i=0; i<record.length; i++){
						                $("#enteringName").val(record[0].memName);
										$("#enteringTelephone").val(record[0].memPhone);
										if(record[i].enteringTime=='AM'){
											if(record[i].enteringStatus=='01'){
												html="<td><a href='javascript:;' class='em1'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
										    }
											else if(record[i].enteringStatus=='02'){
												html="<td><a href='javascript:;' class='em2'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
											}else{
												html="<td><a href='javascript:;' class='em3'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
											}
											$("#am").append(html);
										}
											
										if(record[i].enteringTime=='PM'){
											if(record[i].enteringStatus=='01'){
												htmls="<td><a href='javascript:;' class='em1'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
											}
											else if(record[i].enteringStatus=='02'){
												htmls="<td><a href='javascript:;' class='em2'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
											}else{
												htmls="<td><a href='javascript:;' class='em3'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
											}
											$("#pm").append(htmls);
										}
										
										}
										
										$(document).on("click",".em1",function(){
											$(".em1").removeClass("active");
											$(this).addClass("active");
											enteringId=$(this).find("span").text();
										})

									}
								}
							});
					  		console.log(num);
							changeDate(num,1000);
					  	}
					});
					//右按钮
					$(".cd-next").click(function(){
						num++;
						pageCount=$("#pageTotal").val();
						var serviceURL = baseUrl+"propertyservicemanagerEnteringManager/getEnteringList.json";
						var pageIndex=num+1;
						var pageSize=12;
						var params = ['pager:pageIndex='+pageIndex,'pager:pageSize='+pageSize];
						var enteringId;
						//根据商品id获取资源可用状态
						$.youi.ajaxUtils.ajax({
							url : serviceURL,
							jsonp : 'data:jsonp',
							data:params.join('&'),
							dataType : 'jsonp',
							async : false,
							success : function(results) {
								if (results && results.records) {
									var record = results.records;
									$("#am").empty();
									$("#pm").empty();
									var amHtml="<td>09：00-12：00</td><td><a href='javascript:;' class='em3'><span id='enteringId' style='display:none'>99</span>不可预约</a></td>";
									var pmHtml="<td>14：00-17：00</td><td><a href='javascript:;' class='em3'>不可预约</a></td>";
									$("#am").append(amHtml);
									$("#pm").append(pmHtml);
									var html="";
									var htmls="";
									for(var i=0; i<record.length; i++){
					                $("#enteringName").val(record[0].memName);
									$("#enteringTelephone").val(record[0].memPhone);
									if(record[i].enteringTime=='AM'){
										if(record[i].enteringStatus=='01'){
											html="<td><a href='javascript:;' class='em1'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
									    }
										else if(record[i].enteringStatus=='02'){
											html="<td><a href='javascript:;' class='em2'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
										}else{
											html="<td><a href='javascript:;' class='em3'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
										}
										$("#am").append(html);
									}
										
									if(record[i].enteringTime=='PM'){
										if(record[i].enteringStatus=='01'){
											htmls="<td><a href='javascript:;' class='em1'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
										}
										else if(record[i].enteringStatus=='02'){
											htmls="<td><a href='javascript:;' class='em2'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
										}else{
											htmls="<td><a href='javascript:;' class='em3'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
										}
										$("#pm").append(htmls);
									}
									
									}
									
									$(document).on("click",".em1",function(){
										$(".em1").removeClass("active");
										$(this).addClass("active");
										enteringId=$(this).find("span").text();
									})

								}
							}
						});
						console.log(num);
						changeDate(num,pageCount);
					})
					//7个日期的变化公共部分
					function changeDate(num,pageCount){
						
			            if(num+1>pageCount){
			            	clearInterval(timer);
			            	$("#msg").text("已经是最后一页了");
				            $(".toast").show();
				            pltime=1;
				            timer=setInterval("closeTanc()",1000);
			            }else{
			        		var z=7;
							for(j=1;j<o;j++){
								for(var i=0;i<j;i++){
									var dd = new Date();
								  	dd = new Date(dd.getTime() + 60*60*24*1000 *(i+z*num)); 
								  	dm=dd.getMonth()+1;
								  	dt=dd.getDate();
								  	dw=dd.getDay();	
								  	$(".ht-table tr th").eq(j).html(dm+"月"+dt+"日"+"<br/>"+weekDay[dw]);
								  	
								}
							}
			            }
				
					};
				    //关闭toast
			        $(".close-toast").click(function(){
			        	clearInterval(timer);
			            $(".toast").hide();
			        })
					
					 $(".hhf-submit").click(function(){	
						 if(!isLogin){
							    clearInterval(timer);
							    $("#msg").text("请登录后重试！");
					            $(".toast").show();
					            pltime=2;
					            timer=setInterval("closeTanc()",1000);
							 	return false;
							}
						var enteringName=$("#enteringName").val();
						var enteringTelephone=$("#enteringTelephone").val();
						if(enteringId == null||enteringId == ""){
							clearInterval(timer);
							$("#msg").text("请选择预约时间");
       			    		$(".toast").show();
       			    	    pltime=2;
				            timer=setInterval("closeTanc()",1000);
							return;
						}
                        if(enteringName == null||enteringName == ""){
                        	clearInterval(timer);
							$("#msg").text("请填写申请人");
       			    		$(".toast").show();
       			    	     pltime=2;
				             timer=setInterval("closeTanc()",1000);
							return;
						}
                        if(enteringTelephone !=null&& enteringTelephone!=""){
       					 if(isMobil(enteringTelephone)){
       							
       						}else{
       							clearInterval(timer);
       							$("#msg").text("电话格式不正确！");
           			    		$(".toast").show();
           			    		pltime=2;
    				            timer=setInterval("closeTanc()",1000);
       							return false;
       						}
       			    	}else{
       			    		clearInterval(timer);
       			    		$("#msg").text("请填写申请人电话");
       			    		$(".toast").show();
       			    		pltime=2;
				            timer=setInterval("closeTanc()",1000);
							return;
       			    	}
                      
						var params=['propertyservicemanagerEntering.enteringId='+enteringId,'enteringName='+enteringName,'enteringTelephone='+enteringTelephone,'enteringType='+enteringType];
						var serviceURL = baseUrl+"propertyservicemanagerEntrecManager/savePropertyservicemanagerEntrec.json";
						//公共方法
						$.youi.ajaxUtils.ajax({
							url:serviceURL,
							data:params.join('&'),
							jsonp:'data:jsonp',
							dataType:'jsonp',
							success:function(results){
								if(results&&results.record){
									$(".bg-tanc.m1").show();
									$('#ti-m1').text('5');
									a=5;
									timer1=setInterval("jump1()",1000);
									/* window.location="yq2.html?enteringType="+enteringType; */
									//window.location=cenUrl+"member/memberCenter/index.html";
								}
							},error:function(XMLHttpRequest, textStatus, errorThrown){
								$("#errorText").text(XMLHttpRequest);
								$(".bg-tanc.m2").show();
								$('#ti-m2').text('5');
								b=5;
								timer2=setInterval("jump2()",1000);
							}
						});
						//校验手机号格式
						function isMobil(s) {
						    	var patrn = /^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;
						   		if (!patrn.exec(s)) return false
						   	 	return true
							}
						
					});
					 $(".tc-close").click(function(){
						 clearInterval(timer1);
						 clearInterval(timer2);
					 })
					
					/*  $(".ht-table").plists({
						template:'',
						jsonpSrc:'http://localhost:8081/jsonp/data.jsp?data:file=yq2-test.json'
					});
					$(".hhf-submit").click(function(){
						var obj={
						enteringName:$("#enteringName").val(),
						enteringTelephone:$("#enteringTelephone").val(),
						enteringEmail:$("#enteringEmail").val(),
						enteringNote:$("#enteringNote").val(),
						};
						var str=JSON.stringify(obj);
						alert(str);
					}); */
				});
				
				//跳转订单中心
				function jumpOrder(){
					window.location=cenUrl+"member/memberCenter/personalCenter/myReservation.html?showFlg=2";
				}
				//返回
				function jumpBack(){
					window.location="yq2.html?enteringType="+enteringType; 
				}
				
				var a,b;
				function jump1(){
					if(a>1){
						a--;
						$("#ti-m1").text(a);
					}else{
						window.location=cenUrl+"member/memberCenter/personalCenter/myReservation.html?showFlg=2";
					}		
				}
				function jump2(){
					if(b>1){
						b--;
						$("#ti-m2").text(b);
					}else{
						window.location="yq2.html?enteringType="+enteringType; 
					}		
				}
				var pltime,timer;
		        function closeTanc(){
		            if(pltime>1){
		                pltime--;
		            }else{
		                $(".toast").hide();
		            }       
		        }
			</script>
			<div class="clearfix">
				<div class="fl w895">				
					<div class="clearfix p30">
						<h3 class="lh40 c-o f20 mb10">选择预约时间</h3>
					</div>
					<div class="ht-bd-box">
						<div class="clearfix">
							<span class="hbb-span"><em class="em1"></em> 可以预约</span>
							<span class="hbb-span"><em class="em2"></em> 预约已满</span>
							<span class="hbb-span"><em class="em3"></em> 不可预约</span>
							<span id="nextPage" style="display:none"></span>
						</div>
						<div class="pr">
							<table class="ht-table">
								<colgroup>
									<col width="102"></col>
									<col width="107"></col>
									<col width="107"></col>
									<col width="107"></col>
									<col width="107"></col>
									<col width="107"></col>
									<col width="107"></col>
									<col></col>
								</colgroup>
								<tr>
									<th style="padding:0px;">
										<div class="xx"> 
											<span>日期</span> 
											<em>时间</em> 
										</div>
									</th>
									<th>12月27日<br/>星期日</th>
									<th>12月28日<br/>星期一</th>
									<th>12月29日<br/>星期二</th>
									<th>12月30日<br/>星期三</th>
									<th>12月31日<br/>星期四</th>
									<th>1月01日<br/>星期五</th>
									<th>1月02日<br/>星期六</th>
								</tr>
								<tr id="am">
									<!-- <td>09：00-12：00</td>
									<td><a href="javascript:;" class="em3"><span id='enteringId' style='display:none'>99</span>不可预约</a></td>
									<td><a href="javascript:;" class="em1">可以预约<br/>（8个）</a></td>
									<td><a href="javascript:;" class="em1">可以预约<br/>（10个）</a></td>
									<td><a href="javascript:;" class="em2">预约已满</a></td>
									<td><a href="javascript:;" class="em1">可以预约<br/>（12个）</a></td>
									<td><a href="javascript:;" class="em2">预约已满</a></td>
									<td><a href="javascript:;" class="em1">可以预约<br/>（12个）</a></td> -->
								</tr>
								<tr id="pm">
									<!-- <td>14：00-17：00</td>
									<td><a href="javascript:;" class="em3">不可预约</a></td>
									<td><a href="javascript:;" class="em1">可以预约<br/>（8个）</a></td>
									<td><a href="javascript:;" class="em1">可以预约<br/>（10个）</a></td>
									<td><a href="javascript:;" class="em1">可以预约<br/>（20个）</a></td>
									<td><a href="javascript:;" class="em1">可以预约<br/>（12个）</a></td>
									<td><a href="javascript:;" class="em2">预约已满</a></td>
									<td><a href="javascript:;" class="em1">可以预约<br/>（12个）</a></td> -->
								</tr>
							</table>
							<div class="change-date cd-prev"><img src="../styles/images/yqfw/left-angle.png"></div>
							<div class="change-date cd-next"><img src="../styles/images/yqfw/right-angle.png"></div>							
						</div>
						
						<h3 class="f16 lh22 pt10 pb10 mt40" style="border-bottom:1px solid #efebeb;">申请人基本信息</h3>
						<form class="ht-hb-form">
							<div><label><em>*</em> 申请人</label> <input type="text" id="enteringName"></div>
							<div><label><em>*</em> 申请人电话</label> <input type="text" id="enteringTelephone"></div>
							<div><label>联系邮箱</label> <input type="text" id="enteringEmail"></div>
							<div><label>备注</label> <textarea id="enteringNote"></textarea></div>
							 <input type="button" value="提交" id="sub" class="hhf-submit" style="margin-left:160px;">
						</form>
					</div>	
				</div>
				<div class="fr w285" style="background-color:transparent">
					<div id="youi_page_rg" class="youi-page-rg clearfix"></div>
					<span id="pageTotal" style="display:none"></span>
				</div>
			</div>
		</div>
	</div>
	<!--***bottom start****************************************-->
	<div id="youi_page_footer" class="youi-page-footer"></div>
	<!--***bottom end****************************************-->
	
	<!--***弹窗 start****************************************-->
	<div class="bg-tanc m1">
		<div class="tanc-con" style="top:50%;margin-top:-225px;width:550px;padding:40px 30px;">
			<a href="javascript:;" class="tc-close"></a>
			<div class="tc mt40">
				<div class="mt20 mb20 f16 lh26">
					<img src="../styles/images/yqfw/correct.png" border="0" class="mr20"/>
				</div>
				<p class="mb10 f16">您已经成功提交申请，请到会员中心查看申请状态。</p>
				<p><span class="c-o f24 tc-time mr5" id="ti-m1">5 </span>秒后，系统将自动跳转</p>
				<!-- <p class="mt10"><a href="" class="c-6">手动跳转 ></a></p> -->
				<div class="clearfix mt15 pt15" style="border-top:1px solid #efecec">
					<a style="cursor:pointer;" onclick="jumpOrder();" class="ib-btn" style="width:120px;">前往查看</a>
					<span class="ml30 mr30"></span>
					<a style="cursor:pointer;" onclick="jumpBack();" class="ib-btn fs-btn" style="width:120px;">返回</a>
				</div>
			</div>
		</div>
	</div>
	<div class="bg-tanc m2">
		<div class="tanc-con" style="top:50%;margin-top:-225px;width:550px;padding:40px 30px;">
			<a href="javascript:;" class="tc-close"></a>
			<div class="tc mt40">
				<div class="mt20 mb20 f16 lh26">
					<img src="../styles/images/yqfw/error.png" border="0" class="mr20"/>
				</div>
				<p class="mb10 f16" id="errorText">你还不是园区内的企业用户，无法进行物业报修操作！</p>
				<p><span class="c-o f24 tc-time mr5" id="ti-m2">5</span>秒后，系统将自动跳转 <a href="" class="c-b1 ml10">手动跳转 ></a></p>
			</div>
		</div>
	</div>

	<div class="toast">
        <div class="toast-con clearfix">
            <div class="close-toast fr"></div>
            <p class="tc mt25 f18" style="color:#ff6715" id="msg">只能选择今天及以后的日期</p>
        </div>
        
    </div>
	<!--***弹窗 end****************************************-->
	

	<script type="text/javascript" src="../scripts/page/right.js"></script>
	<script type="text/javascript">
	var serviceURL = baseUrl+"propertyservicemanagerEnteringManager/getEnteringList.json";
	var pageIndex=1;
	var pageSize=12;
	var params = ['pager:pageIndex='+pageIndex,'pager:pageSize='+pageSize];
	var enteringId;
	//根据商品id获取资源可用状态
	$.youi.ajaxUtils.ajax({
		url : serviceURL,
		jsonp : 'data:jsonp',
		data:params.join('&'),
		dataType : 'jsonp',
		async : false,
		success : function(results) {
			if (results && results.records) {
				var record = results.records;
			     var pageCount=Math.ceil(record[0].total/pageSize);
			     $("#pageTotal").val(pageCount);
				var amHtml="<td>09：00-12：00</td><td><a href='javascript:;' class='em3'><span id='enteringId' style='display:none'>99</span>不可预约</a></td>";
				var pmHtml="<td>14：00-17：00</td><td><a href='javascript:;' class='em3'>不可预约</a></td>";
				$("#am").append(amHtml);
				$("#pm").append(pmHtml);
				var html="";
				var htmls="";
				for(var i=0; i<record.length; i++){
                $("#enteringName").val(record[0].memName);
				$("#enteringTelephone").val(record[0].memPhone);
				if(record[i].enteringTime=='AM'){
					if(record[i].enteringStatus=='01'){
						html="<td><a href='javascript:;' class='em1'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
				    }
					else if(record[i].enteringStatus=='02'){
						html="<td><a href='javascript:;' class='em2'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
					}else{
						html="<td><a href='javascript:;' class='em3'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
					}
					$("#am").append(html);
				}
					
				if(record[i].enteringTime=='PM'){
					if(record[i].enteringStatus=='01'){
						htmls="<td><a href='javascript:;' class='em1'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
					}
					else if(record[i].enteringStatus=='02'){
						htmls="<td><a href='javascript:;' class='em2'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
					}else{
						htmls="<td><a href='javascript:;' class='em3'><span id='enteringId' style='display:none'>"+record[i].enteringId+"</span>"+record[i].enteringStatusName+"("+record[i].enteringRemain+"个)</a></td>";
					}
					$("#pm").append(htmls);
				}
				
				}
				
				$(document).on("click",".em1",function(){
					$(".em1").removeClass("active");
					$(this).addClass("active");
					enteringId=$(this).find("span").text();
				})

			}
		}
	});
	
		
</script>

</body>
</html>