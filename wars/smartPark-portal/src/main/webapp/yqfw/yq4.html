<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>访客管理</title>
	<link href="../styles/base.css" type="text/css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="../styles/page/zs.css">
	<link rel="stylesheet" type="text/css" href="../styles/page/awesome/css/font-awesome.min.css">
	<script type="text/javascript" src="../scripts/lib/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="../scripts/lib/jquery-ui.min.js"></script>
	<script type="text/javascript" src="../scripts/lib/bootstrap.min.js"></script>
	<script type="text/javascript" src="../scripts/lib/giui.min.js"></script>
	<script type="text/javascript" src="../scripts/page/laydate/laydate.js"></script>
	<script type="text/javascript" src="../scripts/page/pagewrapper.js"></script>
	<script type="text/javascript" src="../scripts/page/url.js"></script>
	<script>
		$(function(){
			laydate({
			    elem: '#timer', //目标元素。由于laydate.js封装了一个轻量级的选择器引擎，因此elem还允许你传入class、tag但必须按照这种方式 '#id .class'
			    format: 'YYYY-MM-DD hh:mm:ss', //日期格式
		        istime: true, //是否开启时间选择
			    event: 'focus' //响应事件。如果没有传入event，则按照默认的click
			});
		})
	</script>
</head>
<body>
	<!--***top start****************************************-->
	<div id="youi_page_header" class="youi-page-header clearfix" dataType="3" dataId="1"></div>
	<!--***top end****************************************-->
	<div class="w100">
		<div class="w1200 clearfix pt30 pb50">
			<div class="h-nav clearfix">
				<a href="../index.html">首页</a><img src="../styles/images/zs/right-j-b.png" border="0" />
				<a href="yq7.html">物业服务</a><img src="../styles/images/zs/right-j-b.png" border="0" />
				<a href="" class="current">访客管理</a>
			</div>
			<div class="clearfix">
				<div class="fl w895">				
					<div class="ht-bd-box">
						<table class="setting-table">
							<colgroup>
								<col width="80"></col>
								<col></col>
								<col width="120"></col>
								<col></col>
							</colgroup>
							<tr id="">
								<td align="center">姓名</td>
								<td><input type="text" id="user"></td>
								<td align="center">性别</td>
								<td>
									<div class="sex-group"><span class="active">男</span><span>女</span></div>
								</td>
							</tr>
							<tr>
								<td align="center">联系电话</td>
								<td><input type="text" id="iphone"></td>
								<!-- <td align="center">到访企业</td>
								<td>
									<input type="text" id="company">
								</td> -->
								<td align="center">到访时间</td>
								<td><input type="text" id="timer" class="laydate-icon"></td>
							</tr>
							<!-- <tr>
								<td align="center">到访时间</td>
								<td><input type="text" id="timer"></td>
								<td></td>
								<td></td>
							</tr> -->
							<tr>
								<td align="center">访客说明</td>
								<td colspan="3">
									<textarea id="userinfo"></textarea>
								</td>
							</tr>
							<tr>
								<td></td>
								<td><input value="提交" class="hhf-submit" type="submit" style="margin-left:0px;"></td>
							</tr>
						</table>
					</div>
					<h4 class="f14 mt20 mb20">访客登记流程说明</h4>	
					<div class="tc pt20 pb20" style="background-color:#f6f6f6;border:1px solid #ecebeb">
						<img src="../styles/images/yqfw/lct4.png" border="0" />
					</div>
				</div>
				<div class="fr w285" style="background-color:transparent">
					<div id="youi_page_rgt" class="youi-page-rgt clearfix"></div>
				</div>
			</div>
		</div>
	</div>
	
	<!--***弹窗 start****************************************-->
	<div class="bg-tanc m2">
		<div class="tanc-con" style="top:50%;margin-top:-225px;width:550px;padding:40px 30px;">
			<a href="javascript:;" class="tc-close"></a>
			<div class="tc mt40">
				<div class="mt20 mb20 f16 lh26">
					<img src="../styles/images/yqfw/correct.png" border="0" class="mr20"/>
				</div>
				<p class="mb10 f16">您已经申请成功，请到会员中心查看。</p>
				<p><span class="c-o f24 tc-time" id="ti-m1">3 </span>秒后，系统将自动跳转</p>
				<p class="mt10"><a style="cursor:pointer;" onclick="jump();" class="c-6">手动跳转 ></a></p>
				<div class="clearfix mt30">
					<a style="cursor:pointer;" onclick="jumpIndex();"  class="c-6"><i class="fa fa-home mr10" style="font-size:24px;"></i>返回首页</a>
					<span class="f14 ml20 mr20 c-6">|</span>
					<a style="cursor:pointer;" onclick="jumpPerson();"  class="c-6"><i class="fa fa-user mr10" style="font-size:20px;"></i>个人中心</a>
				</div>
			</div>
		</div>
</div>
	<div class="toast">
        <div class="toast-con clearfix">
            	<div class="close-toast fr"></div>
           	 <p class="tc mt25 f18" style="color:#ff6715">请登录后重试！</p>
        	</div>       
    </div>
	<!--***弹窗 end****************************************-->
	
	<!--***bottom start****************************************-->
	<div id="youi_page_footer" class="youi-page-footer"></div>
	<!--***bottom end****************************************-->
	<script type="text/javascript" src="../scripts/page/right.js"></script>
	
	<!-- 页面数据初始化 -->
	<script type="text/javascript">
	$.youi.ajaxUtils.ajax({
		url:baseUrl+"enterpriseEmployeesManager/getEnterEmployforpage.json", 
		jsonp:'data:jsonp',
		dataType:'jsonp',
		success:function(result){
			if(result&&result.record){
				$("#iphone").val(result.record.employeesTelephone);
				$("#user").val(result.record.employeesName);
			}
		}
	});
	</script>
<script>
$(function(){
	$(".hhf-submit").click(function(){
		/* var obj={
			createUser:$("#user").val(),
			fkcodeSex:$(".sex-group span.active").index(),//0-男，1女
			fkcodeTelephone:$("#iphone").val(),
			fkcodeComp:$("#company").val(),
			fkcodeTime:$("#timer").val(),
			fkcodeRemark:$("#userinfo").val()
			};
		var str=JSON.stringify(obj);
		alert(str); */
		if(!isLogin){
			clearInterval(timer);
           	$(".toast").show();
           	pltime=1;
           	timer=setInterval("closeTanc()",1000);
		} 
		//判断是否是企业员工
		$.youi.ajaxUtils.ajax({
		url:baseUrl+"enterpriseEmployeesManager/getEnterEmployforpage.json", 
		jsonp:'data:jsonp',
		dataType:'jsonp',
		success:function(result){
			if(result&&result.record){
				var phone = $("#iphone").val();
				var sex = $(".sex-group span.active").index()+1;
				var time = $("#timer").val();
				if(phone=="" || phone.length==0){
					clearInterval(timer);
					$(".tc.mt25").text("请输入联系电话！");
		           	$(".toast").show();
		           	pltime=1;
		           	timer=setInterval("closeTanc()",1000);
					return false;
				}else{
					if(!isMobil(phone)){
						clearInterval(timer);
						$(".tc.mt25").text("手机号格式不正确!");
			           	$(".toast").show();
			           	pltime=1;
			           	timer=setInterval("closeTanc()",1000);
						return false;
					}else{
						if(time=="" || time.length==0){
							clearInterval(timer);
							$(".tc.mt25").text("请输入到访时间!");
				           	$(".toast").show();
				           	pltime=1;
				           	timer=setInterval("closeTanc()",1000);
							return false;
						}
					}
				}
				
				var params = ['fkcodeName='+$("#user").val(),
								'fkcodeSex='+sex,
								'fkcodeTelephone='+phone,
							//	'fkcodeComp='+$("#company").val(),
								'fkcodeTime='+$("#timer").val(),
								'fkcodeRemark='+$("#userinfo").val()];
				var serviceURL = baseUrl+"propertyservicemanagerFkcodeManager/savePropertyservicemanagerFkcode.json";
				
				//公共方法
				$.youi.ajaxUtils.ajax({
					url:serviceURL,
					data:params.join('&'),
					jsonp:'data:jsonp',
					dataType:'jsonp',
					success:function(results){
						if(results&&results.record){
							$(".bg-tanc.m2").show();
							countdown(3);
							//window.location=cenUrl+"member/memberCenter/propertyService/propertyManageFk.html";
						}
					}
				});
			}else{
				clearInterval(timer);
				$(".tc.mt25").text("您不是企业用户,暂时无法申请!");
	           	$(".toast").show();
	           	pltime=1;
	           	timer=setInterval("closeTanc()",1000);
				return false;
			}
		}
		});
	});
	//校验手机号格式
	function isMobil(s) {
	    var patrn = /^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;
	    if (!patrn.exec(s)) return false
	    return true
	}
})
</script>
 <script type="text/javascript">
		//toast弹窗出来后，一秒自动关闭,请再调用弹窗toast的时候调用该方法
		 var pltime,timer;
		 function closeTanc(){
		     if(pltime>1){
		         pltime--;
		     }else{
		         $(".toast").hide();
		     }       
		 };
		 //关闭toast
	        $(".close-toast").click(function(){
	            $(".toast").hide();
	        });
		 //调用方法如下，哪里调用就放哪里
		 /**
		     clearInterval(timer);
		     $(".toast").show();
		     pltime=1;
		     timer=setInterval("closeTanc()",1000);
		 */
		 
		//定时跳转
		 function countdown(i){
		 	$("#ti-m1").text(i);
		     i = i - 1;
		     if(i > 0) {
		         setTimeout("countdown("+i+")", 1000);
		     }else{
		     	jump();
		     }
		 }
		 //跳转访客
		 function jump(){
		 	window.location.href=cenUrl+"member/memberCenter/propertyService/propertyManageFk.html";
		 }
		 //跳转个人中心
		 function jumpPerson(){
		 	window.location.href=cenUrl+"member/memberCenter/personalCenter/personInfo.html";
		 }
		 //跳转首页
		 function jumpIndex(){
		 	window.location.href=cenUrl;
		 }
</script>
</body>
</html>