<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>机票预定编辑</title>
	<!-- <link href="styles/awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet"> -->
	<link href="styles/base.css" type="text/css" rel="stylesheet">
	<link href="styles/page/zs.css" type="text/css" rel="stylesheet">
	<link href="styles/page/hotel.css" type="text/css" rel="stylesheet" >
	<script type="text/javascript" src="scripts/lib/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="scripts/lib/jquery-ui.min.js"></script>
	<script type="text/javascript" src="scripts/lib/bootstrap.min.js"></script>
	<script type="text/javascript" src="scripts/lib/giui.min.js"></script>
	<script type="text/javascript" src="scripts/page/pagewrapper.js"></script>
	<script type="text/javascript" src="scripts/page/url.js"></script>
	<script type="text/javascript" src="scripts/airlines/airline.js"></script>
</head>
<body>
	<!--***top start****************************************-->
	<div id="youi_page_header" class="youi-page-header clearfix"></div>
	<!--***top end****************************************-->
	<div class="w100">
		<div class="w1200 clearfix pt30 pb50">
            <div style="width:890px;" class="fl">
                <div class="h-nav clearfix" style="margin-bottom:20px;">
                    <a href=""><span>航程信息</span></a> <font class="c-333 f12 fl ml10 mr10">|</font>
                    <a href=""><span class="current">去程</span></a>
                </div>
                <div class="clearfix hc-con-h">
                    <table id="flightInfo">
                        <tr>
                            <td class="c-333">北京————上海</td>
                            <td class="c-333">四川航空3u8421</td>
                            <td>起飞：北京首都机场</td>
                            <td>票价：<span class="c-o">￥3840</span></td>
                        </tr>
                         <tr>
                            <td>2016-01-29 10:55:00</td>
                            <td>机型 : 320</td>
                            <td>抵达：上海虹桥机场</td>
                            <td>税费：<span class="c-o">¥50</span></td>
                        </tr>
                    </table>
                    <a href=""><div class="hch-pa">重新选择航班</div></a>
                </div>
                <div class="hc-con-c mt20">
                    <p class="c-333 mb10">退改签规则：</p>
                    <p id="rule">取消座位时间计算手续费;按照当前舱位票面价收取退票费;起飞前2.0小时（含）以外免收退票费,起飞前2.0小时以内及起飞后收取当前舱位票面价的10.0%退票费;可以改签;</p>
                </div>
               
                <div class="clearfix mt30">
                	<h3 class="c-o f16">乘机人信息：<span class="f12 c-b1">[请准确填写乘机人信息，以免在办理登机时发生问题。带*为必填项]</span></h3>
                	<div class="person-info clearfix" id="person-info">
                	  
                	</div>
                	<div class="hc-con-infor mt10">
	                   	<table>
	                   		<colgroup>
	                   			<col width="100"></col>
	                   			<col></col>
	                   		</colgroup>
	                   		<tr>
	                   			<td valign="top">购票类型<em>*</em></td>
	                   			<td>
	                   					<select id="passengerType" class="passengerType">
		                   					<option value="ADULT">成人</option>
		                   					<option value="CHD">儿童</option>
		                   				</select>
	                   					<span class="ml10">￥3840/成人（含税费）</span>
	                   			</td>
	                   		</tr>
	                   		<tr>
	                   		    <td>真实姓名<em>*</em></td>
	                   		    <td>
	                   			    <!--  <input class="name" name="name" placeholder="乘客姓名" id="pName" type="text" value="" />-->
	                   				<input type="text" class="pName" placeholder="乘客姓名" id="pName" name="pName" style="width:220px;">
	                   				<label class="error"></label>
	                   			</td>
	                   		</tr>	 
	                   		<tr>
	                   			<td>证件号码<em>*</em></td>
	                   			<td>
	                   				<select id="identityType">
	                   					<option value="1">身份证</option>
	                   					<option value="2">护照</option>
	                   					<option value="3">军官证</option>
	                   					<option value="4">士兵证</option>
	                   					<option value="5">台胞证</option>
	                   					<option value="6">其他</option>
	                   				</select>
	                   				<input type="text" class="ml10" style="width:220px;" id="identityNo" name="identityNo">
	                   				<label class="error"></label>
	                   			</td>
	                   		</tr>
	                   		<tr>
	                   			<td>保险<em>*</em></td>
	                   			<td>
	                   				<select class="insurance" id="insurance">
	                   					<option value="20">￥20/份</option>
	                   					<option value="30">￥30/份</option>
	                   				</select>
	                   				<label class="error"></label>
	                   			</td>
	                   		</tr>
	                   		<tr id="addPassenger">
	                   			<td colspan="2"><a href="javascript:;" class="open-tanc" id="open-tanc"><i class="fa fa-plus-circle mr5"></i>新增乘机人</a></td>
	                   		</tr>
	                   	</table>
	                </div>
                </div>
                 <div class="clearfix mt30">
                	<h3 class="c-o f16">联系人信息：<span class="f12 c-b1">[带*为必填项]</span></h3>
                	<div class="hc-con-infor mt10">
	                   	<table>
	                   		<colgroup>
	                  			<col width="100"></col>
	                   			<col></col>
	                   		</colgroup>
	                   		<tr>
	                   			<td valign="top">真实姓名<em>*</em></td>
	                   			<td>
                   					<input type="text" id="linkMan" name="linkMan">
                   					<label class="error"></label>
	                   			</td>
	                   		</tr>
	                   		<tr>
	                   			<td>手机号码<em>*</em></td>
	                   			<td>
	                   				<input type="text" id="linkPhone" name="linkPhone">
	                   				<label class="error"></label>
	                   			</td>
	                   		</tr>
	                   		<tr>
	                   			<td>电话</td>
	                   			<td>
	                   				<input type="text" id="otherLinkMethod" name="otherLinkMethod">
	                   				
	                   			</td>
	                   		</tr>
	                   		<tr>
	                   			<td>电子邮箱</td>
	                   			<td>
	                   				<input type="text" id="email" name="email">
	                   			</td>
	                   		</tr>
	                   		<tr>
	                   			<td>验证码<em>*</em></td>
	                   			<td>
	                   				<input type="text">
	                   				<a href="javascript:;" class="ml15 open-tanc">发送验证码</a>
	                   			</td>
	                   		</tr>
	                   		<tr>
	                   			<td class="c-o">发票信息</td>
	                   			<td>
	                   				<span>需要发票</span>
	                   			</td>
	                   		</tr>
	                   	</table>
	                </div>
                </div>
                <div class="clearfix hc-con-h mt20 tr" >
                    <span>共<font class="c-o"> 1 </font>名乘机人 订单总计费用：<font class="c-o f24">1300</font></span>
                    <a href="javascript:toSubmit()" class="ib-btn" style="margin:10px 20px;">下一步</a>
                </div>
            </div>
            <div class="fr" style="width:288px;">
            	<div class="hc-fr-table" id="hc-fr-table">
            		<h3>结算信息</h3>
            		<table>
            			<colgroup>
            				<col width="200"></col>
            				<col></col>
            			</colgroup>
            			<tbody>
            				<tr>
	            				<th>总计人数：</th>
	            				<td id="person_num">1人</td> 
	            			</tr>
	            			<tr>
	            				<th>票价金额：   </th>
	            				<td id="price">1230</td> 
	            			</tr>
	            			<tr>
	            				<th>机建费： </th>
	            				<td>50</td> 
	            			</tr>
	            			<tr>
	            				<th>燃油附加： </th>
	            				<td> 0</td> 
	            			</tr>
	            			<tr>
	            				<th style="padding-bottom:20px;">保险金额：</th>
	            				<td style="padding-bottom:20px;">20</td> 
	            			</tr>
            			</tbody>
            			<tfoot>
            				<tr>
	            				<th>合计金额： </th>
	            				<td> ¥<span class="f24" id="totalDollar">1300</span></td> 
	            			</tr>
            			</tfoot>
            			
            		</table>
            	</div>
            </div>
		</div>
	</div>
	<!--***bottom start****************************************-->
	<div id="youi_page_footer" class="youi-page-footer"></div>
	<!--***bottom end****************************************-->
	<script type="text/javascript">
	//公用一个参数列表
	var Request = GetRequest();
	$(function(){
		//航程信息
		var html_ = "<tr><td class='c-333'>" +Request['fromcity']+ "————" +Request['gotocity']+ "</td>";
		html_ += "<td class='c-333'>"+airlines[Request['flightNo'].substring(0,2)]+Request['flightNo'].substring(2)+"</td>";
		html_ += "<td>起飞："+airport[Request['orgCity']]+"</td>";
		html_ += "<td>票价：<span class='c-o'>￥"+Request['parPrice']+"</span></td></tr>";
        html_ += "<tr><td>"+airport[Request['gotoCode']]+" "+Request['depTime']+"</td>";
        html_ += "<td>机型 : "+Request['planeType']+"</td>";
        html_ += "<td>抵达："+airport[Request['arrCity']]+"</td>";
        html_ += "<td>机建费：<span class='c-o'>¥ "+Request['airportTax']+"</span></td></tr>";
        $("#flightInfo").empty();
        $("#flightInfo").append(html_);
        //绑定  编辑状态数据 
        var linkMan = Request['linkMan'];
        if(linkMan){
        	//绑定联系人信息
            linkMan = linkMan.split("-");
        	$("#linkMan").val(linkMan[0]);
        	$("#linkPhone").val(linkMan[1]);
        	if(linkMan[2]!="null"){
        		$("#otherLinkMethod").val(linkMan[2])
        	}
        	if(linkMan[3]!="null"){
        		$("#email").val(linkMan[3]);
        	}
        }
        if(Request['passengers']){
        	//绑定乘机人信息
        }
        //绑定右侧栏数据
        updateData();
	});
	//转到提交页
	function toSubmit(){
		//验证联系人信息填写  乘机人勾选
		if(!$("#person-info .person-info-list>.focus")){
			alert("请选择联系人！")
			return;
		}
		if(!$("#linkMan").val()){
			$("#linkMan").siblings(".error").html("请填写真实姓名")
			return;
		}
		if(!$("#linkPhone").val()){
			$("#linkPhone").siblings(".error").html("请填写手机号")
			return;
		}
		var linkMan = $("#linkMan").val()+"-"+$("#linkPhone").val();
		if($("#otherLinkMethod").val()!=""&&$("#otherLinkMethod").val().length!=0){
			linkMan+="-"+$("#otherLinkMethod").val()
		}else{
			linkMan+="-null";
		}
		if($("#email").val()!=""&&$("#email").val().length!=0){
			linkMan+="-"+$("#email").val();
		}else{
			linkMan+="-null";
		}
		Request['linkMan']=linkMan;
		var params = "";
		for(var o in Request){
			params+="&"+o+"="+Request[o];
		}
		var url = "hcxx-tj.html?" + params.substring(1);
		window.open(encodeURI(url));
	}
	
	//获取请求URL
	function GetRequest() {
	   var url = decodeURI(location.search); //获取url中"?"符后的字串
	   var theRequest = new Object();
	   if (url.indexOf("?") != -1) {
	      var str = url.substr(1);
	      strs = str.split("&");
	      for(var i = 0; i < strs.length; i ++) {
	         theRequest[strs[i].split("=")[0]]=(strs[i].split("=")[1]);
	      }
	   }
	   return theRequest;
	}
	//更新右侧栏的统计数据
	function updateData(){
		if($("#person-info .person-info-list i.focus")){
			var len = $("#person-info .person-info-list i.focus").length
			$("#person_num").html(len+"人");
			$("#price").html("￥"+Request["parPrice"])
			$("#totalDollar").html(len*Request["parPrice"]);
			//alert(len)
		}
	}
	</script>
	 <script>
			var urlParams = Request;
			$.youi.ajaxUtils.ajax({
				url : baseUrl+"TicketServiceManager/getModifyAndRefundStipulate.json",
				data:'airlineCode='+urlParams['flightNo'].substring(0,2)+'&classCode='+urlParams['seatCode']+'&depDate='+urlParams['gotodate']+'&depCode='+urlParams['fromCode']+'&arrCode='+urlParams['gotoCode'],
				jsonp : 'data:jsonp',
				dataType : 'jsonp',
				success : function(result) {
					if (result && result.record) {
						$("#rule").html(decodeURIComponent(result.record.refundStipulate))
					} else {
						$("#rule").html("暂无规则！");
					}
				},
				error : function() {
					$("#rule").html("暂无规则！");
				}
			});
                </script>
	<script>
	$(function(){
		$("#open-tanc").on("click",function(){
			//姓名
			var pName = $("#pName");
			if(pName.val()==""||pName.val().length==0){
				pName.siblings(".error").html("乘客姓名不能为空！")
			    return;
			}
			var identityNo = $("#identityNo"); 
			if(identityNo.val()==""||identityNo.val().length==0){
				identityNo.siblings(".error").html("证件号码不能为空！")
				return;
			}
			//验证
			var html = "<div class='person-info-list'><input type='hidden' value='"+pName.val()+"-"+identityNo.val()+"-"+$("#passengerType").val()+"' /><i></i><span>"+pName.val()+"("+identityNo.val()+")</span><span>"+$("#passengerType").find("option:selected").text()+"</span><span>保险："
	          +$(this).parents("table").find(".insurance").val()+"元/份</span><a href='javascript:void(0)'>编辑</a></div>";
		   $(".person-info").append(html);
		   //清空
		   pName.val("");
		   identityNo.val("");
		   $("#insurance option:first-child,#identityType option:first-child,#passengerType option:first-child").attr("selected",true)
		   $(".hc-con-infor .error").html("");
		})
		$("#person-info").on("click",".person-info-list>i",function(){
			$(this).toggleClass("focus");
			//改变Request中passengers的值
			var passenger = "";
			$("#person-info .person-info-list>.focus").each(function(){
				passenger+=":"+$(this).siblings("input").val();
			})
			Request['passengers']=passenger.substring(1);
			updateData();
		})
		
	})
	</script>
	
</body>
</html>